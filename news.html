<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Valorian News</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ---------- dark-theme defaults ---------- */
:root{
  --bg:#0d1117;
  --card:#161b22;
  --border:#30363d;
  --text:#c9d1d9;
  --link:#58a6ff;
  --accent:#238636;
  --danger:#da3633;
}
* {box-sizing:border-box; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif;}
body{margin:0;background:var(--bg);color:var(--text);line-height:1.5;}
a{color:var(--link);text-decoration:none;}
button{cursor:pointer;border:none;padding:.5rem 1rem;border-radius:.25rem;background:var(--accent);color:#fff;}
button:hover{filter:brightness(1.1);}
textarea,input{width:100%;padding:.5rem;border-radius:.25rem;border:1px solid var(--border);background:var(--card);color:var(--text);resize:vertical;}

/* ---------- layout ---------- */
.news-header{display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem;border-bottom:1px solid var(--border);}
.news-main{max-width:800px;margin:2rem auto;padding:0 1rem;}
.post,.editor{background:var(--card);border:1px solid var(--border);border-radius:.5rem;padding:1rem;margin-bottom:1rem;}
.post small{color:#8b949e;}
.post img,.post iframe{max-width:100%;margin-top:.5rem;border-radius:.25rem;}
.post-actions{margin-top:.5rem;font-size:.9rem;}
.comment-box{display:flex;gap:.5rem;margin-top:.5rem;}
.toolbar{display:flex;gap:.5rem;margin-bottom:.5rem;}
.toolbar button{background:var(--border);}
#preview{min-height:120px;border:1px dashed var(--border);padding:.5rem;border-radius:.25rem;background:#010409;margin-top:.5rem;}
.danger{background:var(--danger);}
</style>
</head>
<body>

<div class="news-header">
  <h1>Valorian News</h1>
  <a href="index.html">‚Üê Back to Hub</a>
</div>

<div class="news-main">

  <!-- Editor (only visible to gov) -->
  <div id="editorArea" class="editor" style="display:none">
    <input id="title" placeholder="Headline / Title" maxlength="120">
    <div class="toolbar">
      <button onclick="wrapSelected('**')" title="Bold"><b>B</b></button>
      <button onclick="wrapSelected('*')" title="Italic"><i>I</i></button>
    </div>
    <textarea id="bodyText" rows="6" placeholder="Article text‚Ä¶"></textarea>
    <input type="file" id="postFile" accept=".pdf,image/*">
    <button onclick="publish()">Publish</button>
    <h4 style="margin:.5rem 0 0;font-size:1rem">Live preview</h4>
    <div id="preview"></div>
  </div>

  <!-- Feed -->
  <div id="feed"></div>
</div>

<script>
/* ---------- storage ---------- */
const STORAGE_KEY = 'valorianNews';
let posts = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

/* ---------- simple markdown converter ---------- */
function md(txt){
  return txt
    .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
    .replace(/\*(.+?)\*/g,'<em>$1</em>')
    .replace(/\n/g,'<br>');
}

/* ---------- gov check ---------- */
const isGov = confirm('Are you a Government member?');
if(isGov) document.getElementById('editorArea').style.display='block';

/* ---------- editor helpers ---------- */
function wrapSelected(mark){
  const ta=document.getElementById('bodyText');
  const [start,end]=[ta.selectionStart,ta.selectionEnd];
  const selected=ta.value.slice(start,end);
  const replacement=mark+selected+mark;
  ta.value=ta.value.slice(0,start)+replacement+ta.value.slice(end);
  ta.focus();
  preview();
}
function preview(){
  const t=document.getElementById('title').value.trim();
  const b=document.getElementById('bodyText').value.trim();
  document.getElementById('preview').innerHTML=
    (t?`<h2>${escape(t)}</h2>`:'') + md(escape(b));
}
document.getElementById('title').addEventListener('input',preview);
document.getElementById('bodyText').addEventListener('input',preview);

/* ---------- publish ---------- */
function publish(){
  const title=document.getElementById('title').value.trim();
  const body=document.getElementById('bodyText').value.trim();
  if(!body)return;
  const fileInput=document.getElementById('postFile');
  const article={title,body,time:Date.now(),file:null,comments:[]};

  if(fileInput.files[0]){
    const reader=new FileReader();
    reader.onload=e=>{
      article.file={type:fileInput.files[0].type,data:e.target.result};
      savePost(article);
    };
    reader.readAsDataURL(fileInput.files[0]);
  }else{
    savePost(article);
  }
}
function savePost(article){
  posts.unshift(article);
  localStorage.setItem(STORAGE_KEY,JSON.stringify(posts));
  document.getElementById('title').value='';
  document.getElementById('bodyText').value='';
  document.getElementById('postFile').value='';
  renderFeed();
}

/* ---------- render ---------- */
function escape(str){
  const div=document.createElement('div');
  div.textContent=str;
  return div.innerHTML;
}
function renderFeed(){
  const feed=document.getElementById('feed');
  feed.innerHTML='';
  posts.forEach((p,idx)=>{
    const div=document.createElement('div'); div.className='post';
    let html=`<small>${new Date(p.time).toLocaleString()}</small>`;
    if(p.title) html+=`<h3>${escape(p.title)}</h3>`;
    html+=`<div>${md(escape(p.body))}</div>`;
    if(p.file){
      const isPdf=p.file.type.includes('pdf');
      html+=isPdf
        ? `<iframe src="${p.file.data}" width="100%" height="400px"></iframe>`
        : `<img src="${p.file.data}" alt="image">`;
    }
    html+=`<div class="post-actions">
      <a onclick="toggleComments(${idx})">üí¨ Comment</a>
      ${isGov?`<a onclick="delPost(${idx})" class="danger">Delete</a>`:''}
    </div>`;
    html+=`<div id="c${idx}" style="display:none">`;
    p.comments.forEach(c=>html+=`<div style="margin-top:.3rem;font-size:.8rem;color:#8b949e">‚Ä¢ ${escape(c)}</div>`);
    html+=`<div class="comment-box"><input placeholder="comment‚Ä¶" id="inp${idx}"><button onclick="addComment(${idx})">‚û§</button></div></div>`;
    div.innerHTML=html;
    feed.appendChild(div);
  });
}
function toggleComments(i){
  const box=document.getElementById('c'+i);
  box.style.display=box.style.display==='none'?'block':'none';
}
function addComment(i){
  const inp=document.getElementById('inp'+i);
  const val=inp.value.trim(); if(!val)return;
  posts[i].comments.push(val); inp.value='';
  localStorage.setItem(STORAGE_KEY,JSON.stringify(posts));
  renderFeed();
}
function delPost(i){          // government only
  if(!confirm('Delete this post?'))return;
  posts.splice(i,1);
  localStorage.setItem(STORAGE_KEY,JSON.stringify(posts));
  renderFeed();
}

/* ---------- init ---------- */
renderFeed();
</script>
</body>
</html>
