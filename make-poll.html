<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Create Poll</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="hub.css">
<style>
body{background:var(--bg);color:var(--text);padding:2rem;max-width:600px;margin:auto}
input,button{padding:.5rem;border:none;border-radius:4px}
input{background:#222;color:var(--text);width:100%;margin-bottom:.5rem}
button{background:var(--accent);color:#fff;cursor:pointer;font-weight:bold}
</style>
</head>
<body>
<div class="small"><a href="hub.html">← Back to Hub</a></div>
<h1>Create New Poll</h1>

<!-- GOV-ONLY GATE -->
<section id="gate">
  <input id="pw" type="password" placeholder="Government password">
  <button onclick="unlock()">Unlock</button>
</section>

<!-- POLL BUILDER -->
<section id="builder" style="display:none">
  <input id="title" placeholder="Question / Title">
  <input id="yes"   placeholder="Yes-label (default: Yes)">
  <input id="no"    placeholder="No-label  (default: No)">
  <input id="days"  type="number" min="0" max="365" value="7"> days
  <input id="hours" type="number" min="0" max="23"  value="0"> hours
  <button onclick="create()">Create Poll</button>
  <p class="small" id="msg"></p>
</section>

<script>
const PASS = 'Vavau4578';
function $(s){return document.querySelector(s)}
function save(k,v){localStorage.setItem(k,JSON.stringify(v))}

window.unlock = function(){
  if ($('input#pw').value === PASS){
    $('section#gate').style.display='none';
    $('section#builder').style.display='block';
  } else {
    alert('Wrong password');
  }
};

window.create = function(){
  const title = $('input#title').value.trim();
  const yes   = $('input#yes').value.trim()   || 'Yes';
  const no    = $('input#no').value.trim()    || 'No';
  const days  = parseInt($('input#days').value)||0;
  const hours = parseInt($('input#hours').value)||0;
  if (!title) return alert('Title required');

  const end = new Date(Date.now() + (days*24+hours)*3600*1000).toISOString();

  const poll = { title, labelYes:yes, labelNo:no, end };
  save('currentPoll', poll);
  save('votes', {});          // reset old votes
  $('p#msg').textContent = 'Poll created / updated – voters will see it immediately.';
};
</script>
</body>
</html>
