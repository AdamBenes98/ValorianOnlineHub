<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VaOS - Valorian Operating System</title>
    <style>
        :root{
            --bg:#000;
            --card:#0a0a0a;
            --border:#222;
            --accent:#dc143c;
            --text:#fff;
            --sub:#aaa;
            --gap:1.2rem;
            font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
        }
        * {box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
        a{color:var(--accent);text-decoration:none}
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        
        .login-container {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .login-container h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            color: var(--accent);
            font-size: 2rem;
        }
        
        .login-form input {
            width: 100%;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border: 1px solid var(--border);
            border-radius: 6px;
            background: #111;
            color: var(--text);
            font-size: 1rem;
        }
        
        .login-form button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 6px;
            background: var(--accent);
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .login-form button:hover {
            background: #ff1744;
            transform: translateY(-2px);
        }
        
        .login-toggle {
            text-align: center;
            margin-top: 1rem;
            color: var(--sub);
        }
        
        .login-toggle a {
            color: var(--accent);
            cursor: pointer;
        }
        
        .error-message {
            color: var(--accent);
            text-align: center;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: rgba(220, 20, 60, 0.1);
            border-radius: 6px;
        }
        
        /* Desktop Environment */
        .desktop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            display: none;
        }
        
        .desktop.active {
            display: block;
        }
        
        /* Taskbar */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 48px;
            background: var(--card);
            border-top: 2px solid var(--accent);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            z-index: 1000;
        }
        
        .start-button {
            background: var(--accent);
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .start-button:hover {
            background: #ff1744;
        }
        
        .taskbar-apps {
            display: flex;
            gap: 0.5rem;
            flex: 1;
            margin: 0 1rem;
        }
        
        .taskbar-app {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }
        
        .taskbar-app:hover {
            background: rgba(255,255,255,0.2);
        }
        
        .taskbar-app.active {
            background: var(--accent);
        }
        
        .system-tray {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: var(--sub);
            font-size: 0.9rem;
        }
        
        /* Start Menu */
        .start-menu {
            position: fixed;
            bottom: 48px;
            left: 1rem;
            width: 300px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            display: none;
            z-index: 1001;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        
        .start-menu.active {
            display: block;
        }
        
        .start-menu-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .start-menu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        /* Desktop Icons */
        .desktop-icons {
            position: absolute;
            top: 2rem;
            left: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.05);
            border: 1px solid transparent;
        }
        
        .desktop-icon:hover {
            background: rgba(255,255,255,0.1);
            border-color: var(--accent);
            transform: translateY(-2px);
        }
        
        .desktop-icon .emoji {
            font-size: 2.5rem;
        }
        
        .desktop-icon span {
            font-size: 0.9rem;
            color: var(--text);
        }
        
        /* Windows */
        .window {
            position: absolute;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            min-width: 400px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .window-header {
            background: rgba(255,255,255,0.05);
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
        }
        
        .window-title {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }
        
        .window-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .window-control {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .window-control:hover {
            transform: scale(1.2);
        }
        
        .window-control.close { background: #ff5f57; }
        .window-control.minimize { background: #ffbd2e; }
        .window-control.maximize { background: #28ca42; }
        
        .window-content {
            flex: 1;
            padding: 1.5rem;
            overflow: auto;
            background: var(--bg);
        }
        
        /* App Content Styles */
        .app-calculator {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            max-width: 300px;
            margin: 0 auto;
        }
        
        .calc-display {
            grid-column: 1 / -1;
            background: #111;
            padding: 1rem;
            text-align: right;
            font-size: 1.5rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            border: 1px solid var(--border);
        }
        
        .calc-btn {
            padding: 1rem;
            border: none;
            background: #1a1a1a;
            color: var(--text);
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }
        
        .calc-btn:hover {
            background: var(--accent);
            color: white;
        }
        
        .calc-btn.operator {
            background: var(--accent);
            color: white;
        }
        
        .app-text-editor {
            width: 100%;
            height: 300px;
            background: #111;
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 1rem;
            font-family: monospace;
            font-size: 1rem;
            resize: vertical;
        }
        
        .app-terminal {
            background: #000;
            color: #0f0;
            font-family: monospace;
            padding: 1rem;
            height: 300px;
            overflow: auto;
            border-radius: 6px;
        }
        
        .terminal-input {
            background: transparent;
            border: none;
            color: #0f0;
            outline: none;
            width: 100%;
            font-family: monospace;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .admin-section {
            margin-bottom: 2rem;
        }
        
        .admin-section h3 {
            color: var(--accent);
            margin-bottom: 1rem;
        }
        
        .user-list {
            background: #111;
            border-radius: 6px;
            padding: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-bottom: 1px solid var(--border);
        }
        
        .user-item:last-child {
            border-bottom: none;
        }
        
        .admin-btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .admin-btn:hover {
            background: #ff1744;
        }
        
        .admin-btn.danger {
            background: #ff4444;
        }
        
        .admin-btn.danger:hover {
            background: #ff6666;
        }
        
        /* User Settings */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .settings-item {
            background: #111;
            padding: 1rem;
            border-radius: 6px;
            border: 1px solid var(--border);
        }
        
        .settings-item label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--sub);
        }
        
        .settings-item input, .settings-item select {
            width: 100%;
            padding: 0.5rem;
            background: #000;
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 4px;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: var(--bg);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 20000;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border);
            border-top: 3px solid var(--accent);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Hidden by default */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen hidden">
        <div class="loading-spinner"></div>
    </div>

    <!-- Login Screen -->
    <div id="login-screen" class="login-screen">
        <div class="login-container">
            <h2>VaOS Login</h2>
            <div id="error-message" class="error-message hidden"></div>
            <form id="login-form" class="login-form">
                <input type="text" id="login-username" placeholder="Username" required>
                <input type="password" id="login-password" placeholder="Password" required>
                <button type="submit">Login</button>
            </form>
            <form id="register-form" class="login-form hidden">
                <input type="text" id="register-username" placeholder="Username" required>
                <input type="password" id="register-password" placeholder="Password" required>
                <input type="password" id="register-confirm" placeholder="Confirm Password" required>
                <button type="submit">Create Account</button>
            </form>
            <div class="login-toggle">
                <span id="form-toggle-text">Don't have an account?</span>
                <a id="form-toggle" onclick="toggleAuthForm()">Register here</a>
            </div>
        </div>
    </div>

    <!-- Desktop Environment -->
    <div id="desktop" class="desktop">
        <!-- Desktop Icons -->
        <div class="desktop-icons">
            <div class="desktop-icon" onclick="openApp('calculator')">
                <div class="emoji">üßÆ</div>
                <span>Calculator</span>
            </div>
            <div class="desktop-icon" onclick="openApp('text-editor')">
                <div class="emoji">üìù</div>
                <span>Text Editor</span>
            </div>
            <div class="desktop-icon" onclick="openApp('terminal')">
                <div class="emoji">üíª</div>
                <span>Terminal</span>
            </div>
            <div class="desktop-icon" onclick="openApp('settings')">
                <div class="emoji">‚öôÔ∏è</div>
                <span>Settings</span>
            </div>
            <div class="desktop-icon" onclick="openApp('admin')" id="admin-icon" style="display:none;">
                <div class="emoji">üëë</div>
                <span>Admin Panel</span>
            </div>
        </div>

        <!-- Windows Container -->
        <div id="windows-container"></div>

        <!-- Taskbar -->
        <div class="taskbar">
            <button class="start-button" onclick="toggleStartMenu()">
                <span>ü™ü VaOS</span>
            </button>
            <div id="taskbar-apps" class="taskbar-apps"></div>
            <div class="system-tray">
                <span id="current-user"></span>
                <span id="system-time"></span>
                <button onclick="logout()" style="background:none;border:none;color:var(--accent);cursor:pointer;">Logout</button>
            </div>
        </div>

        <!-- Start Menu -->
        <div id="start-menu" class="start-menu">
            <div class="start-menu-item" onclick="openApp('calculator')">
                <span>üßÆ</span>
                <span>Calculator</span>
            </div>
            <div class="start-menu-item" onclick="openApp('text-editor')">
                <span>üìù</span>
                <span>Text Editor</span>
            </div>
            <div class="start-menu-item" onclick="openApp('terminal')">
                <span>üíª</span>
                <span>Terminal</span>
            </div>
            <div class="start-menu-item" onclick="openApp('settings')">
                <span>‚öôÔ∏è</span>
                <span>Settings</span>
            </div>
            <div class="start-menu-item" onclick="openApp('admin')" id="admin-menu" style="display:none;">
                <span>üëë</span>
                <span>Admin Panel</span>
            </div>
        </div>
    </div>

  <script type="module">
    // Import Firebase functionality
    import { vaosFirebase } from './vaos-firebase.js';

    // Update the VaOS class to use Firebase
    class VaOS {
        constructor() {
            this.currentUser = null;
            this.userData = null;
            this.windows = new Map();
            this.windowId = 0;
            this.init();
        }

        async init() {
            await vaosFirebase.init();
            this.setupEventListeners();
            this.updateClock();
            setInterval(() => this.updateClock(), 1000);
        }

        setupEventListeners() {
            // Login/Register forms
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await this.login();
            });

            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await this.register();
            });
        }

        async login() {
            const email = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            
            const result = await vaosFirebase.login(email, password);
            if (!result.success) {
                this.showError(result.error);
            }
        }

        async register() {
            const email = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;

            if (password !== confirm) {
                this.showError('Passwords do not match');
                return;
            }

            const result = await vaosFirebase.register(email, password, email.split('@')[0]);
            if (!result.success) {
                this.showError(result.error);
            }
        }

        logout() {
            vaosFirebase.logout();
        }

        showLogin() {
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('desktop').classList.remove('active');
        }

        showDesktop() {
            this.currentUser = vaosFirebase.currentUser;
            this.userData = vaosFirebase.userData;
            
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('desktop').classList.add('active');
            document.getElementById('current-user').textContent = this.userData?.username || 'User';
            
            // Show admin features if admin
            if (this.userData?.role === 'admin') {
                document.getElementById('admin-icon').style.display = 'flex';
                document.getElementById('admin-menu').style.display = 'block';
            }
        }

        showError(message) {
            const errorDiv = document.getElementById('error-message');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => errorDiv.classList.add('hidden'), 5000);
        }

        updateClock() {
            const now = new Date();
            document.getElementById('system-time').textContent = now.toLocaleTimeString();
        }

        async saveNotes() {
            if (!this.currentUser) return;
            const textEditor = document.querySelector('.app-text-editor');
            if (textEditor) {
                this.userData.notes = textEditor.value;
                const result = await vaosFirebase.saveUserData();
                if (result.success) {
                    alert('Notes saved successfully!');
                } else {
                    alert('Error saving notes: ' + result.error);
                }
            }
        }

        // ... rest of your existing methods remain the same ...
        // Just remove the hardcoded authentication logic
    }

    // Global functions (keep these as they were)
    function toggleAuthForm() {
        // ... existing code ...
    }

    function toggleStartMenu() {
        // ... existing code ...
    }

    function openApp(appName) {
        vaos.openApp(appName);
    }

    function logout() {
        vaos.logout();
    }

    // Initialize VaOS
    window.vaos = new VaOS();

    // Close start menu when clicking outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('#start-menu') && !e.target.closest('.start-button')) {
            document.getElementById('start-menu').classList.remove('active');
        }
    });
</script>
</body>
</html>
