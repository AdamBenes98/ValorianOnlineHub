<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>GovVault – Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="hub.css">
<style>
  :root{ --red:#ff5252; --bg:#111; --text:#fff; --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; }
  body{margin:0;background:var(--bg);color:var(--text);font-family:var(--font);display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh}
  .news-header{display:flex;justify-content:space-between;align-items:center;width:100%;max-width:600px;padding:1rem 2rem}
  .news-header a{color:var(--red);text-decoration:none}
  .vault-login{display:flex;flex-direction:column;gap:.75rem;width:100%;max-width:320px}
  .vault-login input,.vault-login button{padding:.6rem;border:none;border-radius:4px;font-size:1rem}
  .vault-login input{background:#222;color:var(--text)}
  .vault-login button{background:var(--red);color:#000;cursor:pointer;font-weight:bold}
</style>
</head>
<body>
<div class="news-header">
  <h1>GovVault</h1>
  <a href="hub.html">← Back to Hub</a>
</div>

<!--  NEW : username + password  -->
<div class="vault-login" id="loginBox">
  <input id="user" type="text" placeholder="Username">
  <input id="pw"   type="password" placeholder="Password">
  <button onclick="check()">Unlock</button>
</div>

<script>
/*  same master credentials as poll page  */
const MASTER_USER = 'master';
const MASTER_PASS = 'M4sterP@ss';

function check(){
  if(document.getElementById('user').value === MASTER_USER &&
     document.getElementById('pw').value   === MASTER_PASS){
    openVault();
  } else {
    alert('Wrong username or password');
  }
}

function openVault(){
  document.body.innerHTML = `
<div class="news-header"><h1>GovVault – Archive</h1><a href="hub.html">← Back to Hub</a></div>
<div class="news-main">
  <div class="new-post">
    <textarea id="memoText" placeholder="Internal memo…"></textarea>
    <input type="file" id="memoFile">
    <button onclick="submitMemo()">Save Memo</button>
  </div>
  <div id="memos"></div>
</div>`;
  renderMemos();
}

/* ----------  remote storage  ---------- */
let memos = [];

async function loadMemos(){
  memos = await fetch('/api/vault').then(r => r.json());
  renderMemos();
}

async function storeMemo(text, file=null){
  const memo = {text, time: Date.now(), file};
  await fetch('/api/vault', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify(memo)
  });
  await loadMemos();        // refresh screen
}

function renderMemos(){
  const div = document.getElementById('memos'); div.innerHTML='';
  memos.forEach(m=>{
    const card=document.createElement('div'); card.className='post';
    let html = `<small>${new Date(m.time).toLocaleString()}</small><pre style="white-space:pre-wrap">${m.text}</pre>`;
    if(m.file){
      html += m.file.type.includes('pdf')
        ? `<iframe src="${m.file.data}" width="100%" height="400px"></iframe>`
        : `<img src="${m.file.data}" alt="image">`;
    }
    card.innerHTML=html; div.appendChild(card);
  });
}

function submitMemo(){
  const text=document.getElementById('memoText').value.trim(); if(!text)return;
  const fileInput=document.getElementById('memoFile');
  const newMemo={text,time:Date.now(),file:null};
  if(fileInput.files[0]){
    const reader=new FileReader();
    reader.onload=e=>{
      newMemo.file={type:fileInput.files[0].type,data:e.target.result};
      memos.unshift(newMemo); saveMemo(); renderMemos();
      document.getElementById('memoText').value=''; fileInput.value='';
    };
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    memos.unshift(newMemo); saveMemo(); renderMemos();
    document.getElementById('memoText').value=''; fileInput.value='';
  }
}
</script>
</body>
</html>
