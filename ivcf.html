<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IVCF 2.0 Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="hub.css">
</head>
<body>
<div class="ivcf-page active">
  <div class="ivcf-header">
    <h1>♟ IVCF 2.0 Hub</h1>
    <nav class="ivcf-nav">
      <a class="active" href="#" data-ipage="home">Home</a>
      <a href="#" data-ipage="ranking">Rankings</a>
      <a href="#" data-ipage="events">Events</a>
      <a href="#" data-ipage="rules">Rules</a>
      <a href="#" data-ipage="calc">Rating Calc</a>
      <a href="#" data-ipage="results">Results</a>
      <a href="index.html">← Back to Hub</a>
    </nav>
  </div>

  <div class="ivcf-main">
    <!-- HOME -->
    <section id="ivcf-home" class="ivcf-section active">
      <h2>Welcome</h2>
      <p>Official portal of the International Valorian Chess Federation (IVCF 2.0).<p>
      <p>
    <a class="license-link" href="https://docs.google.com/forms/d/e/1FAIpQLSewCmbN4NJd_HeksuZkVm66dDKt7P0s6thkgYmj4S0FK3TGGA/viewform?usp=header" target="_blank">
      Get a License
    </a>
  </p>

    </section>

    <!-- RANKINGS -->
    <section id="ivcf-ranking" class="ivcf-section">
      <h2>Live Rankings</h2>
      <div class="ivcf-card">
        <input id="rankSearch" placeholder="Search player / team / nation">
      </div>
      <table class="ivcf-table" id="rankTable">
        <thead>
          <tr><th>#</th><th>Player</th><th>Team</th><th>Nation</th><th>CCR</th><th>Title</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- EVENTS -->
    <section id="ivcf-events" class="ivcf-section">
      <h2>Upcoming Events</h2>
      <div class="ivcf-card">
        <h3>CCWT – Centralian Chess World Tournament</h3>
        <p>Main event - Starting Dtae unclear - $200 k 1st place.</p>
      </div>
      <div class="ivcf-card">
        <h3>VCC – Valorian Chess 960 Cup</h3>
        <p>Randomized starting positions.  Prestige bonus only.</p>
      </div>
    </section>

    <!-- RULES -->
    <section id="ivcf-rules" class="ivcf-section">
      <h2>Quick-Reference Rules</h2>
      <div class="ivcf-card">
        <h3>Licensing</h3>
        <ul>
          <li>One-time $20 k payment on licensing.</li>
          <li>Grants access to all official events & CCR tracking.</li>
        </ul>
      </div>
      <div class="ivcf-card">
        <h3>CCR Formula (IVCF 2.1 – faster climb)</h3>
        <p class="mono">New = Old + K×(Result − E) + Bonus</p>
        <p>K = 50 (&lt;1400), 40 (1400-1799), 32 (1800-2199), 24 (2200-2399), 10 (2400+)</p>
        <p>E = 1 / (1 + 10^((Opp − Old) / 400))</p>
        <p>Bonuses: <br>
           +15 for beating +200 rating opponent<br>
           +10 for beating +100 rating opponent<br>
           +5  for beating +50  rating opponent<br>
           No inactivity penalty.</p>
      </div>
      <div class="ivcf-card">
        <h3>Title & Prestige (per tournament entry)</h3>
        <table class="ivcf-table">
          <thead><tr><th>Title</th><th>Range</th><th>Bonus</th></tr></thead>
          <tbody>
            <tr><td>IC (Intermediate Candidate)</td><td>400-999</td><td>$1 k</td></tr>
            <tr><td>AC (Advanced Candidate)</td><td>1000-1399</td><td>$2 k</td></tr>
            <tr><td>SCM (Senior Centralian Master)</td><td>1400-1699</td><td>$4 k</td></tr>
            <tr><td>CCM (Centralian Candidate Master)</td><td>1700-1999</td><td>$6 k</td></tr>
            <tr><td>CIM (Centralian International Master)</td><td>2000-2299</td><td>$8 k</td></tr>
            <tr><td>CE (Centralian Elite)</td><td>2300-2499</td><td>$12 k</td></tr>
            <tr><td>CEC (Centralian Elite Champion)</td><td>2500+</td><td>$20 k</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- RATING CALCULATOR -->
    <section id="ivcf-calc" class="ivcf-section">
      <h2>Rating Calculator</h2>

      <!-- existing calculator -->
      <div class="ivcf-card">
        <label>Your current CCR<br><input class="ivcf-input" id="cOld" type="number" value="1800"></label><br>
        <label>Opponent CCR<br><input class="ivcf-input" id="cOpp" type="number" value="2000"></label><br>
        <label>Result<br>
          <select class="ivcf-select" id="cRes">
            <option value="1">Win</option>
            <option value="0.5">Draw</option>
            <option value="0">Loss</option>
          </select>
        </label><br>
        <button class="ivcf-button" onclick="calcRating()">Calculate new CCR</button>
        <p id="cOut"></p>
      </div>

      <!-- NEW: first-ever CCR card -->
      <div class="ivcf-card">
        <h3>First-Ever CCR (vs 1000-bot)</h3>
        <label>Chess.com estimated rating after game<br>
          <input class="ivcf-input" id="est" type="number" value="1000"></label><br>
        <label>Result vs bot<br>
          <select class="ivcf-select" id="botRes">
            <option value="1">Win</option>
            <option value="0.5">Draw</option>
            <option value="0">Loss</option>
          </select></label><br>
        <button class="ivcf-button" onclick="firstCCR()">Calculate starting CCR</button>
        <p id="firstOut"></p>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="ivcf-results" class="ivcf-section">
      <h2>Event Results</h2>
      <p>No Results here yet, but hopefully in the future :)</p>
      <div class="ivcf-card">
        <h3>Test (Place Holder)</h3>
        <table class="ivcf-table">
          <thead><tr><th>Place</th><th>Player</th><th>Prize</th></tr></thead>
          <tbody>
            <tr><td>1st</td><td>Test Player</td><td>$200 k</td></tr>
            <tr><td>2nd</td><td>---</td><td>$100 k</td></tr>
            <tr><td>3rd-4th</td><td>---</td><td>$50 k</td></tr>
          </tbody>
        </table>
      </div>
    </section>
</div>

<script>
/* ---------- existing data & helpers ---------- */
const players = [
  {id:"Beeba",  name:"Beeba",  team:"None",      nation:"Valoria", ccr:1143},
  {id:"Dwayne",   name:"Dwayne",   team:"None", nation:"Solar", ccr:1503},
];
const titleFromCCR = c=> c<1000?'IC':c<1400?'AC':c<1700?'SCM':c<2000?'CCM':c<2300?'CIM':c<2500?'CE':'CEC';

function buildRanking(){
  const list = players.map(p=>({...p,title:titleFromCCR(p.ccr)})).sort((a,b)=>b.ccr-a.ccr);
  const tbody = document.querySelector('#rankTable tbody');
  tbody.innerHTML='';
  list.forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${p.name}</td><td>${p.team}</td><td>${p.nation}</td><td>${p.ccr}</td><td>${p.title}</td>`;
    tbody.appendChild(tr);
  });
}
buildRanking();

document.getElementById('rankSearch').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase();
  document.querySelectorAll('#rankTable tbody tr').forEach(row=>{
    row.style.display=row.innerText.toLowerCase().includes(q)?'':'none';
  });
});

document.querySelectorAll('.ivcf-nav a[data-ipage]').forEach(a=>{
  a.addEventListener('click',ev=>{
    ev.preventDefault();
    document.querySelectorAll('.ivcf-section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.ivcf-nav a').forEach(x=>x.classList.remove('active'));
    const page=a.dataset.ipage;
    document.getElementById('ivcf-'+page).classList.add('active');
    a.classList.add('active');
  });
});

/* ---------- existing rating calculator ---------- */
function calcRating(){
  const old = +document.getElementById('cOld').value;
  const opp = +document.getElementById('cOpp').value;
  const res = +document.getElementById('cRes').value;

  let k = 50;
  if (old >= 2400) k = 10;
  else if (old >= 2200) k = 24;
  else if (old >= 1800) k = 32;
  else if (old >= 1400) k = 40;

  const e = 1 / (1 + 10 ** ((opp - old) / 400));
  let delta = k * (res - e);

  if (res === 1){
    const diff = opp - old;
    if (diff >= 200) delta += 15;
    else if (diff >= 100) delta += 10;
    else if (diff >= 50) delta += 5;
  }

  const neu = Math.round(old + delta);
  let bonus = '';
  if (delta > k * 0.75) bonus = ' (big upset bonus)';
  else if (delta > 0) bonus = ' (bonus)';

  document.getElementById('cOut').textContent = `New CCR: ${neu}${bonus}`;
}

/* ---------- NEW first-ever CCR function ---------- */
function firstCCR(){
  const est   = +document.getElementById('est').value;
  const res   = +document.getElementById('botRes').value;
  const bot   = 1000;

  let k = 50;
  const e = 1 / (1 + 10 ** ((bot - est) / 400));
  let delta = k * (res - e);

  if (res === 1){
    const diff = bot - est;
    if (diff >= 200) delta += 100;
    else if (diff >= 100) delta += 75;
    else if (diff >= 50) delta += 50;
    else delta += 25;
  }
  if (res === 0.5) delta += 25;

  const start = Math.round(est + delta);
  document.getElementById('firstOut').textContent =
    `Starting CCR: ${start}  (use this as “old” in the rating calculator)`;
}
</script>
</body>
</html>
