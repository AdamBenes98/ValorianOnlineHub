<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>GovVault – Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root{
  --bg:#111;
  --text:#ffffff;
  --sub:#999;
  --red:#ff5252;
  --radius:4px;
  --font:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
}
@media (prefers-color-scheme:light){
  :root{--bg:#1e1e1e;--card:#1e1e1e;--text:#ffffff;--sub:#aaa;}
}
*{box-sizing:border-box;font-family:var(--font)}
body{margin:0;background:var(--bg);color:var(--text);padding:2rem}
a{color:var(--red)}
.small{font-size:.8rem;color:var(--sub)}
h1{margin:0 0 1rem}
/* ----  login card  ---- */
.login-card{background:#1e1e1e;padding:1.5rem;border-radius:8px;max-width:380px;margin:auto}
.login-card input{width:100%;padding:.5rem;margin-bottom:.75rem;background:#222;color:var(--text);border:none;border-radius:var(--radius)}
.login-card button{width:100%;padding:.5rem;border:none;border-radius:var(--radius);background:var(--red);color:#000;font-weight:bold;cursor:pointer}
.login-card button:hover{filter:brightness(1.15)}
/* ----  archive  ---- */
.controls{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}
.controls input{flex:1;min-width:180px;padding:.5rem;background:#222;color:var(--text);border:none;border-radius:var(--radius)}
.controls button{padding:.5rem .75rem;border:none;border-radius:var(--radius);background:var(--red);color:#000;font-weight:bold;cursor:pointer}
.post{background:#1e1e1e;padding:1rem;border-radius:8px;margin-bottom:1rem;position:relative}
.post small{display:block;margin-bottom:.5rem;color:var(--sub)}
.post pre{white-space:pre-wrap;margin:0}
.post img,.post iframe{max-width:100%;margin-top:.5rem;border-radius:4px}
.post .del{position:absolute;top:.5rem;right:.5rem;background:var(--red);color:#000;border:none;padding:.25rem .5rem;border-radius:4px;cursor:pointer;font-weight:bold}
</style>
</head>
<body>

<!-- =========  LOGIN  ========= -->
<div id="loginWrap" class="login-card">
  <h1>GovVault</h1>
  <input id="userIn" type="text" placeholder="Username">
  <input id="pwIn"  type="password" placeholder="Password">
  <button onclick="unlock()">Unlock</button>
  <p class="small"><a href="index.html">← Back to main page</a></p>
</div>

<!-- =========  VAULT  (hidden until unlocked)  ========= -->
<div id="vault" style="display:none">
  <div class="controls">
    <h1>GovVault – Archive</h1>
    <a href="index.html" style="margin-left:auto">← Back to Hub</a>
  </div>

  <div class="controls">
    <textarea id="memoText" placeholder="Internal memo / directive …" rows="3"></textarea>
    <input type="file" id="memoFile">
    <button onclick="submitMemo()">Save Memo</button>
  </div>

  <div class="controls">
    <input id="searchIn" type="text" placeholder="Search memos …" oninput="filterMemos()">
    <button onclick="downloadArchive()">Download Archive (.json)</button>
  </div>

  <div id="memos"></div>
</div>

<script>
/* ----------  CONFIG  ---------- */
const ADMIN = { user:'master', pass:'M4sterP@ss' };   // change me
const MEMO_KEY = 'govMemos';

let memos = JSON.parse(localStorage.getItem(MEMO_KEY)) || [];

/* ----------  LOGIN  ---------- */
window.unlock = () => {
  const u = userIn.value.trim(), p = pwIn.value;
  if (u === ADMIN.user && p === ADMIN.pass){ 
    loginWrap.style.display = 'none';
    vault.style.display = 'block';
    renderMemos();
  } else {
    alert('Wrong username or password');
  }
};

/* ----------  MEMO CRUD  ---------- */
window.submitMemo = () => {
  const text = memoText.value.trim();
  if (!text) return;
  const fileInput = memoFile;
  const entry = {text, time:Date.now(), file:null};

  if (fileInput.files[0]){
    const reader = new FileReader();
    reader.onload = e => {
      entry.file = {type:fileInput.files[0].type, data:e.target.result, name:fileInput.files[0].name};
      saveAndRender(entry);
    };
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    saveAndRender(entry);
  }
};
function saveAndRender(entry){
  memos.unshift(entry);
  localStorage.setItem(MEMO_KEY, JSON.stringify(memos));
  memoText.value = ''; memoFile.value = '';
  renderMemos();
}
window.deleteMemo = idx => {
  if (!confirm('Delete this memo?')) return;
  memos.splice(idx,1);
  localStorage.setItem(MEMO_KEY, JSON.stringify(memos));
  renderMemos();
};
window.downloadArchive = () => {
  const blob = new Blob([JSON.stringify(memos, null, 2)], {type:'application/json'});
  const a = Object.assign(document.createElement('a'), {
    href: URL.createObjectURL(blob),
    download: `GovVault-${new Date().toISOString().slice(0,10)}.json`
  });
  a.click();
};
window.filterMemos = () => {
  const term = searchIn.value.toLowerCase();
  document.querySelectorAll('.post').forEach((card,i) => {
    card.style.display = memos[i].text.toLowerCase().includes(term) ? 'block' : 'none';
  });
};

/* ----------  RENDER  ---------- */
window.renderMemos = () => {
  memosDiv.innerHTML = '';
  memos.forEach((m, i) => {
    const card = document.createElement('div'); card.className = 'post';
    let html = `<small>${new Date(m.time).toLocaleString()}</small>
                <pre>${m.text}</pre>`;
    if (m.file){
      if (m.file.type.includes('pdf')){
        html += `<iframe src="${m.file.data}" width="100%" height="400px"></iframe>`;
      } else {
        html += `<img src="${m.file.data}" alt="${m.file.name||'image'}">`;
      }
    }
    html += `<button class="del" onclick="deleteMemo(${i})">✕</button>`;
    card.innerHTML = html;
    memosDiv.appendChild(card);
  });
};
</script>
</body>
</html>
