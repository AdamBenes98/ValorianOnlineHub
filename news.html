<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>News Feed</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
/* ---------- CSS RESET & TOKENS ---------- */
:root{
  --bg:#000;
  --card:#0a0a0a;
  --border:#222;
  --accent:#dc143c;
  --text:#fff;
  --sub:#aaa;
  --gap:1.2rem;
  --radius:8px;
  --font:"Inter",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
#editor{
  width:100%; min-height:90px;
  background:#111; color:var(--text);
  border:1px solid #333; border-radius:var(--radius);
  padding:.7rem; font-family:inherit;
  white-space:pre-wrap;           /* keep line-breaks */
}
#editor:empty:before{
  content:attr(placeholder);
  color:#666;
}
/* ----- format-bar ----- */
#formatBar{display:flex;align-items:center}
#formatBar button,#formatBar select{background:#222;color:#fff;border:1px solid #444;border-radius:4px;padding:.3rem .5rem;font-size:.9rem;cursor:pointer}
#formatBar button:hover{background:#333}

/* ----- three-dots menu fix ----- */
.opts{position:relative}
.optsMenu{position:absolute;top:100%;right:0;margin-top:.3rem;background:#111;border:1px solid #333;border-radius:4px;overflow:hidden;opacity:0;pointer-events:none;transition:opacity .15s;z-index:10}
.opts.open .optsMenu{opacity:1;pointer-events:auto}
.optsMenu a{display:block;padding:.5rem .9rem;font-size:.8rem;color:var(--text);white-space:nowrap}
.optsMenu a:hover{background:#222}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:var(--font);min-height:100vh;display:flex;flex-direction:column}
a{color:var(--accent);text-decoration:none}
button{cursor:pointer;font-family:inherit;border:none}
img{max-width:100%;display:block;border-radius:var(--radius)}

/* ---------- HEADER ---------- */
header{background:var(--card);border-bottom:2px solid var(--accent);padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between}
header h1{font-size:1.5rem}
#backBtn{background:var(--accent);color:#fff;padding:.5rem .9rem;border-radius:var(--radius);font-weight:bold}

/* ---------- MAIN LAYOUT ---------- */
main{flex:1;padding:2rem 1rem;max-width:700px;margin:auto;width:100%}
#composer{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;margin-bottom:2rem}
#composer textarea{width:100%;min-height:90px;background:#111;color:var(--text);border:1px solid #333;border-radius:var(--radius);padding:.7rem;resize:vertical;font-family:inherit}
#composerOptions{display:flex;flex-wrap:wrap;gap:.7rem;margin-top:.7rem;align-items:center}
#composer input[type=file]{display:none}
#composer label[for=fileInp]{background:#222;padding:.4rem .7rem;border-radius:var(--radius);cursor:pointer;font-size:.8rem}
#composer select,#composer input[type=color]{background:#222;color:var(--text);border:1px solid #333;border-radius:var(--radius);padding:.3rem .5rem;font-size:.8rem}
#postBtn{margin-left:auto;background:var(--accent);color:#fff;padding:.5rem 1rem;border-radius:var(--radius);font-weight:bold}

/* ---------- POSTS ---------- */
.post{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:1rem;margin-bottom:1.2rem;position:relative;transition:box-shadow .15s}
.post:hover{box-shadow:0 4px 18px #0008}
.post.pinned{border:1px solid var(--accent)}
.post.highlighted{background:#1f0f0f}
.postHeader{display:flex;align-items:center;gap:.5rem;font-size:.9rem;color:var(--sub);margin-bottom:.5rem}
.postHeader .badge{background:var(--accent);color:#fff;font-size:.6rem;padding:.15rem .35rem;border-radius:4px}
.postText{margin:.7rem 0;line-height:1.4}
.postAttachment{margin-top:.7rem}
.postActions{display:flex;gap:1.2rem;font-size:.9rem;margin-top:.7rem}
.postActions span{cursor:pointer;opacity:.8;transition:opacity .15s}
.postActions span:hover{opacity:1}
.postActions .liked{color:#1da1f2}
.postActions .disliked{color:#e0245e}

/* ---------- OPTIONS DROPDOWN (FIXED) ---------- */
.opts{position:relative}
.optsMenu{position:absolute;top:1.4rem;right:0;background:#111;border:1px solid #333;border-radius:var(--radius);overflow:hidden;opacity:0;pointer-events:none;transition:opacity .15s;z-index:10}
.opts:hover .optsMenu{opacity:1;pointer-events:auto}
.optsMenu a{display:block;padding:.5rem .9rem;font-size:.8rem;color:var(--text);white-space:nowrap}
.optsMenu a:hover{background:#222}

/* ---------- ADMIN LOGIN MODAL ---------- */
.modal{display:none;position:fixed;inset:0;background:#000a;align-items:center;justify-content:center;z-index:100}
.modal.active{display:flex}
.modalContent{background:#111;border:1px solid #333;border-radius:var(--radius);padding:1.5rem;width:90%;max-width:320px}
.modalContent h3{margin-bottom:1rem}
.modalContent input{width:100%;padding:.6rem;margin-bottom:.7rem;background:#222;color:var(--text);border:1px solid #333;border-radius:var(--radius)}
.modalContent button{width:100%;padding:.6rem;border-radius:var(--radius);background:var(--accent);color:#fff;font-weight:bold}

/* ---------- SORT BAR ---------- */
#sortBar{display:flex;gap:1rem;margin-bottom:1rem;font-size:.9rem}
#sortBar span{cursor:pointer;opacity:.7}
#sortBar span.active{opacity:1;font-weight:bold}

/* ---------- RESPONSIVE ---------- */
@media(max-width:600px){
  header{padding:1rem}
  main{padding:1rem .5rem}
}
</style>
</head>
<body>

<header>
  <h1>News Feed</h1>
  <a href="index.html" id="backBtn">‚Üê Back to Main Page</a>
</header>

<main>
  <!-- SORT BAR -->
  <div id="sortBar">
    <span class="active" data-sort="new">Newest</span>
    <span data-sort="top">Most Liked</span>
  </div>

 <!-- COMPOSER -->
<section id="composer">
  <!-- NEW: hidden div that will receive the formatted HTML -->
  <div id="hiddenHTML" style="display:none" contenteditable="true"></div>

  <!-- visible textarea for raw typing -->
  <textarea id="draft" placeholder="What‚Äôs happening?"></textarea>

  <!-- format-bar (appears only when the cursor is inside the textarea) -->
  <div id="formatBar" style="display:none;gap:.4rem;margin:.4rem 0">
    <button data-cmd="bold" title="bold"><b>B</b></button>
    <button data-cmd="italic" title="italic"><i>I</i></button>
    <button data-cmd="underline" title="underline"><u>U</u></button>
    <button data-cmd="foreColor" title="colour" style="color:#ff004c">A</button>
    <select id="sizeSelect" title="size">
      <option value="3">normal</option>
      <option value="4">large</option>
      <option value="5">huge</option>
    </select>
  </div>

  <div id="composerOptions">
    <input id="fileInp" type="file" accept="image/*,.pdf" />
    <label for="fileInp">üìé Attach</label>
    <input id="userInp" type="text" placeholder="Username (optional)" />
    <button id="postBtn">Post</button>
  </div>
</section>

 <!-- FEED -->
<div id="feed"></div>
</main>

<!-- ADMIN LOGIN MODAL -->
<div id="loginModal" class="modal">
  <div class="modalContent">
    <h3>Admin Login</h3>
    <input id="loginUser" placeholder="Username" autocomplete="off" />
    <input id="loginPass" type="password" placeholder="Password" />
    <button id="loginBtn">Login</button>
  </div>
</div>

<script>
/* ---------- UTILS ---------- */
const qs=s=>document.querySelector(s);
const qsa=s=>[...document.querySelectorAll(s)];
const randId=_=>Math.random().toString(36).slice(2)+Date.now().toString(36);

/* ---------- STATE ---------- */
let posts=JSON.parse(localStorage.getItem('newsPosts')||'[]');
let adminMode=false;
const adminCreds={user:'master',pass:'M4sterP@ss'};

/* ---------- SIMPLE EDITOR ---------- */
const editor = qs('#editor');
const sizeSel= qs('#sizeSelect');

/* bold / italic */
qs('#formatBar').addEventListener('click',e=>{
  const btn = e.target.closest('button');
  if(!btn) return;
  const cmd = btn.dataset.cmd;
  document.execCommand(cmd,false,null);
  editor.focus();
});

/* size selector */
sizeSel.onchange = ()=>{
  document.execCommand('fontSize',false,'7');   // biggest <font> tag
  const sel = window.getSelection();
  if(sel.rangeCount){
    const span = sel.getRangeAt(0).commonAncestorContainer.parentElement;
    span.style.fontSize = sizeSel.value+'px';
    span.removeAttribute('size');
  }
  editor.focus();
};

/* ---------- SORT / RENDER ---------- */
const sortPosts=mode=>{
  if(mode==='top') posts.sort((a,b)=>(b.likes||0)-(a.likes||0));
  else posts.sort((a,b)=>b.date-a.date);
};
const render=_=>{
  sortPosts(qs('#sortBar span.active').dataset.sort);
  qs('#feed').innerHTML='';
  posts.forEach(p=>qs('#feed').appendChild(buildPostEl(p)));
};
const save=_=>localStorage.setItem('newsPosts',JSON.stringify(posts));

/* ---------- POST BUILDER ---------- */
function buildPostEl(p){
  const d=document.createElement('div');
  d.className='post'+(p.pinned?' pinned':'')+(p.highlighted?' highlighted':'');
  d.dataset.id=p.id;
  const attachHtml=p.attachment
    ? (p.attachment.type.startsWith('image')
        ? `<img src="${p.attachment.url}" />`
        : `<small>üìÑ Attached: ${p.attachment.name}</small>`)
    : '';
  d.innerHTML=`
    <div class="postHeader">
      <b>${esc(p.user||'Anonymous')}</b>
      ${p.admin?'<span class="badge">ADMIN</span>':''}
      <span>¬∑</span>
      <time>${fmtTime(p.date)}</time>
      ${p.pinned?'<span>üìå Pinned</span>':''}
    </div>
    <div class="postText">${p.html||esc(p.text)}</div>
    <div class="postAttachment">${attachHtml}</div>
    <div class="postActions">
      <span class="like ${p.liked?'liked':''}" data-id="${p.id}">üëç ${p.likes||0}</span>
      <span class="dislike ${p.disliked?'disliked':''}" data-id="${p.id}">üëé ${p.dislikes||0}</span>
      <span class="share" data-id="${p.id}">üîó Share</span>
      <div class="opts">
        <span>‚ãÆ</span>
        <nav class="optsMenu">
          <a class="shareLink" data-id="${p.id}">Copy link</a>
          <a class="report" data-id="${p.id}">Report</a>
          <a class="adminBtn">Admin Features</a>
        </nav>
      </div>
    </div>
  `;
  /* three-dots toggle */
  const opts=d.querySelector('.opts');
  opts.querySelector('span').onclick=_=>opts.classList.toggle('open');
  document.addEventListener('click',e=>{
    if(!opts.contains(e.target)) opts.classList.remove('open');
  });
  /* likes */
  d.querySelector('.like').onclick=e=>toggleLike(p.id,true);
  d.querySelector('.dislike').onclick=e=>toggleLike(p.id,false);
  /* share */
  d.querySelector('.share').onclick=_=>sharePost(p.id);
  d.querySelector('.shareLink').onclick=_=>copyLink(p.id);
  /* report */
  d.querySelector('.report').onclick=_=>alert('Reported. Thank you.');
  /* admin */
  d.querySelector('.adminBtn').onclick=_=>openAdmin(p.id);
  return d;
}
function esc(str){return str.replace(/[&<>"']/g,c=>'&#'+c.charCodeAt(0)+';');}
function fmtTime(ts){
  const d=new Date(ts),now=Date.now(),diff=(now-ts)/1000;
  if(diff<60) return 'now';
  if(diff<3600) return Math.floor(diff/60)+'m';
  if(diff<86400) return Math.floor(diff/3600)+'h';
  return d.toLocaleDateString();
}

/* ---------- INTERACTIONS ---------- */
function toggleLike(id,isLike){
  const p=posts.find(x=>x.id===id);
  if(!p) return;
  if(isLike){
    if(p.liked){ p.likes--; p.liked=false; }
    else { p.likes=(p.likes||0)+1; p.liked=true; if(p.disliked){p.dislikes--;p.disliked=false;} }
  }else{
    if(p.disliked){ p.dislikes--; p.disliked=false; }
    else { p.dislikes=(p.dislikes||0)+1; p.disliked=true; if(p.liked){p.likes--;p.liked=false;} }
  }
  save(); render();
}
function sharePost(id){
  const url=`${location.origin}${location.pathname}#${id}`;
  if(navigator.share) navigator.share({title:'News post',url});
  else copyLink(id);
}
function copyLink(id){
  const url=`${location.origin}${location.pathname}#${id}`;
  navigator.clipboard.writeText(url);
  alert('Link copied!');
}

/* ---------- ADMIN ---------- */
let activePostId=null;
function openAdmin(id){ activePostId=id; qs('#loginModal').classList.add('active'); }
qs('#loginBtn').onclick=_=>{
  const u=qs('#loginUser').value, p=qs('#loginPass').value;
  if(u===adminCreds.user && p===adminCreds.pass){
    adminMode=true;
    qs('#loginModal').classList.remove('active');
    showAdminTools();
  }else{
    alert('Wrong credentials');
  }
};
function showAdminTools(){
  const postEl=qs(`.post[data-id="${activePostId}"]`);
  if(!postEl) return;
  const existing=postEl.querySelector('.adminBar');
  if(existing) return;
  const bar=document.createElement('div');
  bar.className='adminBar';
  bar.style.marginTop='.7rem';
  bar.innerHTML=`
    <button class="editBtn">Edit</button>
    <button class="delBtn">Delete</button>
    <button class="pinBtn">${posts.find(x=>x.id===activePostId).pinned?'Unpin':'Pin'}</button>
    <button class="hlBtn">${posts.find(x=>x.id===activePostId).highlighted?'Un-highlight':'Highlight'}</button>
  `;
  bar.querySelector('.editBtn').onclick=_=>editPost(activePostId);
  bar.querySelector('.delBtn').onclick=_=>delPost(activePostId);
  bar.querySelector('.pinBtn').onclick=_=>togglePin(activePostId);
  bar.querySelector('.hlBtn').onclick=_=>toggleHighlight(activePostId);
  postEl.appendChild(bar);
}
function editPost(id){
  const p=posts.find(x=>x.id===id);
  const newText=prompt('Edit text:',p.text);
  if(newText===null) return;
  p.text=newText; p.html=null; save(); render();
}
function delPost(id){
  if(!confirm('Delete forever?')) return;
  posts=posts.filter(x=>x.id!==id); save(); render();
}
function togglePin(id){
  const p=posts.find(x=>x.id===id);
  p.pinned=!p.pinned; save(); render();
}
function toggleHighlight(id){
  const p=posts.find(x=>x.id===id);
  p.highlighted=!p.highlighted; save(); render();
}

/* ---------- COMPOSER POST ---------- */
qs('#postBtn').onclick=()=>{
  const html=editor.innerHTML.trim();
  if(!html) return;

  const fileInp=qs('#fileInp'), file=fileInp.files[0];
  const attachment=file?{name:file.name, type:file.type, url:URL.createObjectURL(file)}:null;

  posts.unshift({
    id:randId(),
    html,
    text:editor.innerText,
    user:qs('#userInp').value.trim(),
    date:Date.now(),
    likes:0, dislikes:0,
    attachment,
    admin:adminMode,
    pinned:false, highlighted:false
  });
  save(); render();
  editor.innerHTML='';
  qs('#userInp').value='';
  fileInp.value='';
};

/* auto-save draft */
const draftKey='newsDraft';
editor.innerHTML=localStorage.getItem(draftKey)||'';
editor.addEventListener('input',()=>localStorage.setItem(draftKey,editor.innerHTML));

/* ---------- SORT BAR ---------- */
qsa('#sortBar span').forEach(el=>{
  el.onclick=_=>{
    qsa('#sortBar span').forEach(s=>s.classList.remove('active'));
    el.classList.add('active');
    render();
  };
});

/* ---------- BOOTSTRAP ---------- */
render();
if(location.hash){
  const id=location.hash.slice(1);
  setTimeout(_=>qs(`[data-id="${id}"]`)?.scrollIntoView({behavior:'smooth'}),300);
}
</script>
</body>
</html>
