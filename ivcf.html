<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IVCF 2.0 Hub</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="hub.css">
<style>
/* ----- minimal extra styling for the compare tool ----- */
/* ---- radar diagram ---- */
#radar{border:1px solid var(--border);border-radius:50%;background:#0001}
.compare-bar{display:flex;gap:1rem;margin-bottom:1rem}
.compare-bar select{flex:1;padding:.5rem;font-size:1rem}
.compare-grid{display:grid;grid-template-columns:1fr auto 1fr;gap:1rem;align-items:center}
.compare-grid .vs{font-size:1.5rem;font-weight:bold}
.compare-grid table{width:100%}
</style>
</head>
<body>
<div class="ivcf-page active">
  <div class="ivcf-header">
    <h1>♟ IVCF 2.0 Hub</h1>
    <nav class="ivcf-nav">
      <a class="active" href="#" data-ipage="home">Home</a>
      <a href="#" data-ipage="ranking">Rankings</a>
      <a href="#" data-ipage="compare">Compare</a>
      <a href="#" data-ipage="events">Events</a>
      <a href="#" data-ipage="rules">Rules</a>
      <a href="#" data-ipage="calc">Rating Calc</a>
      <a href="#" data-ipage="results">Results</a>
      <a href="index.html">← Back to Hub</a>
    </nav>
  </div>

  <div class="ivcf-main">
    <!-- HOME -->
    <section id="ivcf-home" class="ivcf-section active">
      <h2>Welcome</h2>
      <p>Official portal of the International Valorian Chess Federation (IVCF 2.0).</p>
      <p>
        <a class="license-link" href="https://docs.google.com/forms/d/e/1FAIpQLSewCmbN4NJd_HeksuZkVm66dDKt7P0s6thkgYmj4S0FK3TGGA/viewform?usp=header" target="_blank">
          Get a License
        </a>
      </p>
    </section>

    <!-- RANKINGS -->
    <section id="ivcf-ranking" class="ivcf-section">
      <h2>Live Rankings</h2>
      <div class="ivcf-card">
        <input id="rankSearch" placeholder="Search player / team / nation">
      </div>
      <table class="ivcf-table" id="rankTable">
        <thead>
          <tr><th>#</th><th>Player</th><th>Team</th><th>Nation</th><th>CCR</th><th>Title</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <!-- COMPARE -->
<!-- =========  NEW COMPARE SECTION  ========= -->
<section id="ivcf-compare" class="ivcf-section">
  <h2>Head-to-Head Compare</h2>

  <div class="ivcf-card">
    <!-- player pickers -->
    <div class="compare-bar">
      <select id="leftPick"><option value="">— pick player —</option></select>
      <select id="rightPick"><option value="">— pick player —</option></select>
    </div>

    <!-- visual radar push diagram -->
    <canvas id="radar" width="380" height="380" style="margin:1rem auto;display:block"></canvas>

    <!-- classic table (still shown under the canvas) -->
    <div id="compareTable" class="compare-grid"></div>
  </div>
</section>

    <!-- STAT TABLES -->
    <div id="compareBox" style="margin-top:1.5rem"></div>
  </div>
</section>

<style>
/* quick radar look */
#radar{background:#fff;border:1px solid #ddd;border-radius:6px}
/* tiny bar numbers */
.power-val{font-size:.75rem;color:#555;margin-left:.3rem}
</style>

<script>
/* ===============  MINI RADAR ENGINE (NO DEPS)  =============== */
function drawRadar(canvas, leftVals, rightVals, labels){
  const ctx = canvas.getContext('2d');
  const w = canvas.width, h = canvas.height, cx = w/2, cy = h/2;
  const sides = labels.length;
  const angleStep = (Math.PI*2)/sides;
  const maxR = Math.min(cx,cy)-30;
  ctx.clearRect(0,0,w,h);

  /* ---- draw web ---- */
  ctx.strokeStyle='#bbb'; ctx.lineWidth=1;
  for(let level=1;level<=5;level++){
    ctx.beginPath();
    for(let i=0;i<sides;i++){
      const angle = i*angleStep - Math.PI/2;
      const x = cx + Math.cos(angle)*maxR*(level/5);
      const y = cy + Math.sin(angle)*maxR*(level/5);
      if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
    }
    ctx.closePath();ctx.stroke();
  }
  for(let i=0;i<sides;i++){
    const angle = i*angleStep - Math.PI/2;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx+Math.cos(angle)*maxR, cy+Math.sin(angle)*maxR);
    ctx.stroke();
  }

  /* ---- draw labels ---- */
  ctx.fillStyle='#000'; ctx.font='13px sans-serif'; ctx.textAlign='center';
  labels.forEach((lab,i)=>{
    const angle = i*angleStep - Math.PI/2;
    const x = cx + Math.cos(angle)*(maxR+18);
    const y = cy + Math.sin(angle)*(maxR+18)+5;
    ctx.fillText(lab,x,y);
  });

  /* ---- helper to draw one data set ---- */
  function drawSet(vals,color,fillAlpha){
    ctx.beginPath();
    vals.forEach((v,i)=>{
      const angle = i*angleStep - Math.PI/2;
      const r = (v/100)*maxR;
      const x = cx + Math.cos(angle)*r;
      const y = cy + Math.sin(angle)*r;
      if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
    });
    ctx.closePath();
    ctx.strokeStyle=color;ctx.lineWidth=2;ctx.stroke();
    ctx.fillStyle=color.replace('rgb','rgba').replace(')',','+fillAlpha+')');
    ctx.fill();
  }

  /* ---- normalise values 0-100 ---- */
  function norm(v,MIN,MAX){ return Math.max(0,Math.min(100,((v-MIN)/(MAX-MIN))*100))}
  const MINmax=[0,3000];                // CCR range
  const WRmax=[0,100];                  // win-rate %
  const Tmax=[0,20];                    // tourneys
  const Bmax=[0,200];                   // bonus k$

  const lNorm = [
    norm(leftVals.ccr , MINmax[0],MINmax[1]),
    norm(leftVals.winR, WRmax[0], WRmax[1]),
    norm(leftVals.tour, Tmax[0],  Tmax[1]),
    norm(leftVals.bonus,Bmax[0], Bmax[1])
  ];
  const rNorm = [
    norm(rightVals.ccr , MINmax[0],MINmax[1]),
    norm(rightVals.winR, WRmax[0], WRmax[1]),
    norm(rightVals.tour, Tmax[0],  Tmax[1]),
    norm(rightVals.bonus,Bmax[0], Bmax[1])
  ];

  drawSet(rNorm,'rgb(239,68,68)',.25);
  drawSet(lNorm,'rgb(59,130,246)',.25);
}

/* ===============  NEW RENDER FUNCTION  =============== */
function renderCompare(){
  const L=players.find(x=>x.id===leftSel.value);
  const R=players.find(x=>x.id===rightSel.value);
  if(!L || !R){
    compareBox.innerHTML='<p>Pick both players.</p>';
    document.getElementById('radar').getContext('2d').clearRect(0,0,300,300);
    document.getElementById('leftBar').style.width='0%';
    document.getElementById('rightBar').style.width='0%';
    return;
  }

  /* ---- extra derived stats ---- */
  const leftWinR  = L.tourneys ? Math.round((L.gamesWon/(L.tourneys*3))*100) : 0;
  const rightWinR = R.tourneys ? Math.round((R.gamesWon/(R.tourneys*3))*100) : 0;
  const leftAvg   = L.tourneys ? (L.bonusEarned/L.tourneys).toFixed(1) : 0;
  const rightAvg  = R.tourneys ? (R.bonusEarned/R.tourneys).toFixed(1) : 0;
  const ccrLead   = Math.abs(L.ccr - R.ccr);

  /* ---- radar data ---- */
  const radarLabs = ['CCR','Win-%','Tourneys','Bonus $k'];
  drawRadar(document.getElementById('radar'),
           {ccr:L.ccr, winR:leftWinR, tour:L.tourneys, bonus:L.bonusEarned},
           {ccr:R.ccr, winR:rightWinR, tour:R.tourneys, bonus:R.bonusEarned},
           radarLabs);

  /* ---- power bars (0-100 scale) ---- */
  const leftPower  = Math.min(100,Math.round((L.ccr/3000)*60 + leftWinR*0.4));
  const rightPower = Math.min(100,Math.round((R.ccr/3000)*60 + rightWinR*0.4));
  document.getElementById('leftBar').style.width  = leftPower+'%';
  document.getElementById('rightBar').style.width = rightPower+'%';
  document.getElementById('leftName').textContent  = L.name;
  document.getElementById('rightName').textContent = R.name;

  /* ---- text tables ---- */
  const row=(label,lVal,rVal,highlight)=>{
    const cls = highlight ? (lVal>rVal?'blue':rVal>lVal?'red':'') : '';
    return `<tr class="${cls}"><td><b>${label}</b></td><td>${lVal}</td><td>${rVal}</td></tr>`;
  };
  compareBox.innerHTML=`
  <table class="ivcf-table">
    ${row('CCR',L.ccr,R.ccr,true)}
    ${row('Title',titleFromCCR(L.ccr),titleFromCCR(R.ccr))}
    ${row('Tournaments entered',L.tourneys,R.tourneys,true)}
    ${row('Games won',L.gamesWon,R.gamesWon,true)}
    ${row('Win-rate %',leftWinR+'%',rightWinR+'%',true)}
    ${row('Avg bonus / tourney','$'+leftAvg+' k','$'+rightAvg+' k',true)}
    ${row('Total bonus earned','$'+L.bonusEarned+' k','$'+R.bonusEarned+' k')}
    ${row('CCR lead vs rival','+'+(L.ccr>R.ccr?ccrLead:0),'+'+(R.ccr>L.ccr?ccrLead:0))}
  </table>`;
}

/* ===============  RE-ATTACH LISTENERS  =============== */
[leftSel,rightSel].forEach(sel=>sel.addEventListener('change',renderCompare));
</script>
<!-- =========================  END NEW COMPARE  ========================= -->
    <!-- EVENTS -->
    <section id="ivcf-events" class="ivcf-section">
      <h2>Upcoming Events</h2>
      <div class="ivcf-card">
        <h3>CCWT – Centralian Chess World Tournament</h3>
        <p>Main event - Starting Date unclear - $200 k 1st place.</p>
      </div>
      <div class="ivcf-card">
        <h3>VCC – Valorian Chess 960 Cup</h3>
        <p>Randomized starting positions.  Prestige bonus only.</p>
      </div>
    </section>

    <!-- RULES -->
    <section id="ivcf-rules" class="ivcf-section">
      <h2>Quick-Reference Rules</h2>
      <div class="ivcf-card">
        <h3>Licensing</h3>
        <ul>
          <li>One-time $20 k payment on licensing.</li>
          <li>Grants access to all official events & CCR tracking.</li>
        </ul>
      </div>
      <div class="ivcf-card">
        <h3>CCR Formula (IVCF 2.1 – faster climb)</h3>
        <p class="mono">New = Old + K×(Result − E) + Bonus</p>
        <p>K = 50 (&lt;1400), 40 (1400-1799), 32 (1800-2199), 24 (2200-2399), 10 (2400+)</p>
        <p>E = 1 / (1 + 10^((Opp − Old) / 400))</p>
        <p>Bonuses: <br>
           +15 for beating +200 rating opponent<br>
           +10 for beating +100 rating opponent<br>
           +5  for beating +50  rating opponent<br>
           No inactivity penalty.</p>
      </div>
      <div class="ivcf-card">
        <h3>Title & Prestige (per tournament entry)</h3>
        <table class="ivcf-table">
          <thead><tr><th>Title</th><th>Range</th><th>Bonus</th></tr></thead>
          <tbody>
            <tr><td>IC (Intermediate Candidate)</td><td>400-999</td><td>$1 k</td></tr>
            <tr><td>AC (Advanced Candidate)</td><td>1000-1399</td><td>$2 k</td></tr>
            <tr><td>SCM (Senior Centralian Master)</td><td>1400-1699</td><td>$4 k</td></tr>
            <tr><td>CCM (Centralian Candidate Master)</td><td>1700-1999</td><td>$6 k</td></tr>
            <tr><td>CIM (Centralian International Master)</td><td>2000-2299</td><td>$8 k</td></tr>
            <tr><td>CE (Centralian Elite)</td><td>2300-2499</td><td>$12 k</td></tr>
            <tr><td>CEC (Centralian Elite Champion)</td><td>2500+</td><td>$20 k</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- RATING CALCULATOR -->
    <section id="ivcf-calc" class="ivcf-section">
      <h2>Rating Calculator</h2>
      <div class="ivcf-card">
        <label>Your current CCR<br><input class="ivcf-input" id="cOld" type="number" value="1800"></label><br>
        <label>Opponent CCR<br><input class="ivcf-input" id="cOpp" type="number" value="2000"></label><br>
        <label>Result<br>
          <select class="ivcf-select" id="cRes">
            <option value="1">Win</option>
            <option value="0.5">Draw</option>
            <option value="0">Loss</option>
          </select>
        </label><br>
        <button class="ivcf-button" onclick="calcRating()">Calculate new CCR</button>
        <p id="cOut"></p>
      </div>
      <div class="ivcf-card">
        <h3>First-Ever CCR (vs 1000-bot)</h3>
        <label>Chess.com estimated rating after game<br>
          <input class="ivcf-input" id="est" type="number" value="1000"></label><br>
        <label>Result vs bot<br>
          <select class="ivcf-select" id="botRes">
            <option value="1">Win</option>
            <option value="0.5">Draw</option>
            <option value="0">Loss</option>
          </select></label><br>
        <button class="ivcf-button" onclick="firstCCR()">Calculate starting CCR</button>
        <p id="firstOut"></p>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="ivcf-results" class="ivcf-section">
      <h2>Event Results</h2>
      <p>No Results here yet, but hopefully in the future :)</p>
      <div class="ivcf-card">
        <h3>Test (Place Holder)</h3>
        <table class="ivcf-table">
          <thead><tr><th>Place</th><th>Player</th><th>Prize</th></tr></thead>
          <tbody>
            <tr><td>1st</td><td>Test Player</td><td>$200 k</td></tr>
            <tr><td>2nd</td><td>---</td><td>$100 k</td></tr>
            <tr><td>3rd-4th</td><td>---</td><td>$50 k</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>

<script>
/* =========================  HARDCODED DATA  ========================= */
/* ---- add / edit players here ---- */
const players = [
  {id:"Beeba", name:"Beeba", team:"None", nation:"Valoria", ccr:1143, tourneys:0, gamesWon:0,  bonusEarned:0},
  {id:"Dwayne",name:"Dwayne",team:"None",nation:"Solar",  ccr:1503, tourneys:0, gamesWon:0, bonusEarned:0},
];

/* ---- helper ---- */
const titleFromCCR = c=> c<1000?'IC':c<1400?'AC':c<1700?'SCM':c<2000?'CCM':c<2300?'CIM':c<2500?'CE':'CEC';

/* =========================  RANKING TABLE  ========================= */
function buildRanking(){
  const list = players.map(p=>({...p,title:titleFromCCR(p.ccr)})).sort((a,b)=>b.ccr-a.ccr);
  const tbody = document.querySelector('#rankTable tbody');
  tbody.innerHTML='';
  list.forEach((p,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${i+1}</td><td>${p.name}</td><td>${p.team}</td><td>${p.nation}</td><td>${p.ccr}</td><td>${p.title}</td>`;
    tbody.appendChild(tr);
  });
}
buildRanking();

document.getElementById('rankSearch').addEventListener('input',e=>{
  const q=e.target.value.toLowerCase();
  document.querySelectorAll('#rankTable tbody tr').forEach(row=>{
    row.style.display=row.innerText.toLowerCase().includes(q)?'':'none';
  });
});

/* =========================  NAVIGATION  ========================= */
document.querySelectorAll('.ivcf-nav a[data-ipage]').forEach(a=>{
  a.addEventListener('click',ev=>{
    ev.preventDefault();
    document.querySelectorAll('.ivcf-section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.ivcf-nav a').forEach(x=>x.classList.remove('active'));
    const page=a.dataset.ipage;
    document.getElementById('ivcf-'+page).classList.add('active');
    a.classList.add('active');
  });
});

/* =========================  COMPARE TOOL  ========================= */
/* =========================  COMPARE TOOL 2.0  ========================= */
const leftSel  = document.getElementById('leftPick');
const rightSel = document.getElementById('rightPick');
const radarCv  = document.getElementById('radar');
const ctx      = radarCv.getContext('2d');
const compareTable = document.getElementById('compareTable');

/* ---- metrics that appear in radar + table ---- */
const metrics = [
  {key:'ccr',          label:'CCR',          maxRaw:3000},
  {key:'tourneys',     label:'Tournaments',  maxRaw:20},
  {key:'gamesWon',     label:'Games won',    maxRaw:100},
  {key:'bonusEarned',  label:'Bonus $ k',    maxRaw:50}
];

/* ---- fill selects ---- */
players.forEach(p=>{
  leftSel .insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name}</option>`);
  rightSel.insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name}</option>`);
});

/* ---- main render ---- */
[leftSel,rightSel].forEach(sel=>sel.addEventListener('change', renderCompare));
function renderCompare(){
  const L = players.find(x=>x.id===leftSel.value);
  const R = players.find(x=>x.id===rightSel.value);
  if(!L || !R){ compareTable.innerHTML='<p>Pick both players.</p>'; return; }

  /* 1.  build normalised dataset (0-100 %) */
  const leftVals  = metrics.map(m=>( L[m.key]/m.maxRaw)*100);
  const rightVals = metrics.map(m=>( R[m.key]/m.maxRaw)*100);

  /* 2.  draw radar */
  drawRadar(leftVals, rightVals);

  /* 3.  classic table */
  let html='<table class="ivcf-table"><tbody>';
  metrics.forEach((m,i)=>{
    html+=`<tr>
      <td><b>${m.label}</b></td>
      <td>${L[m.key]}</td>
      <td>${R[m.key]}</td>
    </tr>`;
  });
  html+='</tbody></table>';
  compareTable.innerHTML=html;
}

/* ---- radar draw ---- */
function drawRadar(L, R){
  const cen = 190;
  const rad = 160;
  const ang = 2*Math.PI / metrics.length;

  ctx.clearRect(0,0,380,380);

  /* helper to plot one data set */
  function shape(arr, color, lineWidth){
    ctx.beginPath();
    arr.forEach((v,i)=>{
      const a = i*ang - Math.PI/2;
      const x = cen + rad*(v/100)*Math.cos(a);
      const y = cen + rad*(v/100)*Math.sin(a);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.closePath();
    ctx.strokeStyle=color; ctx.lineWidth=lineWidth;
    ctx.stroke();
    ctx.fillStyle=color+'22'; ctx.fill();
  }

  /* grid lines */
  for(let g=1;g<=4;g++){
    ctx.beginPath();
    for(let i=0;i<=metrics.length;i++){
      const a = i*ang - Math.PI/2;
      const x = cen + rad*(g/4)*Math.cos(a);
      const y = cen + rad*(g/4)*Math.sin(a);
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    }
    ctx.strokeStyle='#9994'; ctx.lineWidth=1; ctx.stroke();
  }

  /* axis labels */
  ctx.font='13px sans-serif'; ctx.fillStyle='#ccc';
  metrics.forEach((m,i)=>{
    const a = i*ang - Math.PI/2;
    const x = cen + (rad+15)*Math.cos(a);
    const y = cen + (rad+15)*Math.sin(a);
    ctx.fillText(m.label,x-ctx.measureText(m.label).width/2,y+4);
  });

  /* player shapes (left=red, right=blue) */
  shape(L, '#f55', 3);
  shape(R, '#55f', 3);
}

/* =========================  CALCULATOR  ========================= */
function calcRating(){
  const old = +document.getElementById('cOld').value;
  const opp = +document.getElementById('cOpp').value;
  const res = +document.getElementById('cRes').value;
  let k = 50;
  if (old >= 2400) k = 10;
  else if (old >= 2200) k = 24;
  else if (old >= 1800) k = 32;
  else if (old >= 1400) k = 40;
  const e = 1 / (1 + 10 ** ((opp - old) / 400));
  let delta = k * (res - e);
  if (res === 1){
    const diff = opp - old;
    if (diff >= 200) delta += 15;
    else if (diff >= 100) delta += 10;
    else if (diff >= 50) delta += 5;
  }
  const neu = Math.round(old + delta);
  let bonus = '';
  if (delta > k * 0.75) bonus = ' (big upset bonus)';
  else if (delta > 0) bonus = ' (bonus)';
  document.getElementById('cOut').textContent = `New CCR: ${neu}${bonus}`;
}

function firstCCR(){
  const est = +document.getElementById('est').value;
  const res = +document.getElementById('botRes').value;
  const bot = 1000;
  let k = 50;
  const e = 1 / (1 + 10 ** ((bot - est) / 400));
  let delta = k * (res - e);
  if (res === 1){
    const diff = bot - est;
    if (diff >= 200) delta += 100;
    else if (diff >= 100) delta += 75;
    else if (diff >= 50) delta += 50;
    else delta += 25;
  }
  if (res === 0.5) delta += 25;
  const start = Math.round(est + delta);
  document.getElementById('firstOut').textContent =
    `Starting CCR: ${start}  (use this as “old” in the rating calculator)`;
}
</script>
</body>
</html>
