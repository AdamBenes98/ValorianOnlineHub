<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>IVCF 2.0 Hub - Enhanced Comparison System</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdnjs.cloudflare.com/ajax/libs/plotly.js/3.0.3/plotly.min.js  "></script>
<style>

:root{
  --bg:#000;
  --card:#0a0a0a;
  --border:#222;
  --accent:#dc143c;
  --text:#fff;
  --sub:#aaa;
  --gap:1.2rem;
  --secondary:#00b4ff;
  --success:#32cd32;
  --warning:#ffd700;
  font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
}
* {box-sizing:border-box;margin:0;padding:0}
body{margin:0;background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}
a{color:var(--accent);text-decoration:none}
header,footer{background:var(--card);border-bottom:2px solid var(--accent)}
header{display:flex;align-items:center;justify-content:space-between;padding:1rem 2rem}
header h1{margin:0;font-size:1.6rem;letter-spacing:1px}
header span{font-weight:300;font-size:.9rem;color:var(--sub)}
main{flex:1;padding:2rem;max-width:1100px;margin:auto;width:100%}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:var(--gap)}
.tile{background:var(--card);border:1px solid var(--border);border-radius:8px;padding:1.5rem 1rem;text-align:center;transition:transform .15s,box-shadow .15s;cursor:pointer;position:relative}
.tile:hover{transform:translateY(-4px);box-shadow:0 8px 24px #0008}
.tile .emoji{font-size:2.2rem;margin-bottom:.5rem}
.tile h3{margin:.4rem 0 .2rem;font-size:1.1rem}
.tile p{font-size:.85rem;color:var(--sub);margin:0}
.tile.external::after{content:"⧉";position:absolute;top:.5rem;right:.7rem;font-size:.8rem;opacity:.6}
footer{text-align:center;padding:1.2rem;font-size:.8rem;color:var(--sub);border-bottom:none;border-top:2px solid var(--accent)}
.badge{display:inline-block;background:var(--accent);color:#fff;padding:.15rem .35rem;border-radius:4px;font-size:.65rem;margin-left:.4rem}
.mono{font-family:monospace}


.ivcf-page{background:var(--bg);color:var(--text);display:none}
.ivcf-page.active{display:block}
.ivcf-header{background:#1e1e1e;border-bottom:2px solid var(--secondary);padding:1rem 2rem;display:flex;align-items:center;gap:1.5rem;flex-wrap:wrap}
.ivcf-header h1{margin:0;font-size:1.6rem;color:var(--text)}
.ivcf-nav{display:flex;gap:1rem;flex-wrap:wrap}
.ivcf-nav a{padding:.4rem .7rem;border-radius:4px;background:#0003;color:var(--text);text-decoration:none;transition:all .3s ease}
.ivcf-nav a.active{background:var(--secondary);color:#000;font-weight:bold}
.ivcf-main{padding:2rem;max-width:1200px;margin:auto}
.ivcf-section{display:none}
.ivcf-section.active{display:block;animation:fadeIn .5s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.ivcf-table{width:100%;border-collapse:collapse;margin-top:1rem;background:var(--card);border-radius:8px;overflow:hidden}
.ivcf-table th,.ivcf-table td{padding:.75rem;text-align:left;border-bottom:1px solid var(--border)}
.ivcf-table th{background:#2a2a2a;color:var(--secondary);font-weight:600}
.ivcf-table tr:hover{background:#1a1a1a}
.ivcf-card{background:#1e1e1e;padding:1.5rem;border-radius:8px;margin-bottom:1.2rem;border:1px solid var(--border)}
.ivcf-input,.ivcf-select,.ivcf-button{padding:.75rem;border:none;border-radius:4px;font-size:1rem}
.ivcf-input,.ivcf-select{background:#222;color:var(--text);width:100%;border:1px solid var(--border)}
.ivcf-input:focus,.ivcf-select:focus{outline:none;border-color:var(--secondary)}
.ivcf-button{background:var(--secondary);color:#000;cursor:pointer;font-weight:bold;transition:all .3s ease}
.ivcf-button:hover{filter:brightness(1.15);transform:translateY(-1px)}


.comparison-container{display:grid;grid-template-columns:1fr 2fr 1fr;gap:2rem;align-items:start;margin-top:2rem}
.player-card{background:linear-gradient(135deg,#1e1e1e,#2a2a2a);border:1px solid var(--border);border-radius:12px;padding:2rem;text-align:center;position:relative;overflow:hidden;transition:all .3s ease}
.player-card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;background:linear-gradient(90deg,var(--accent),var(--secondary))}
.player-card:hover{transform:translateY(-5px);border-color:var(--secondary)}
.player-avatar{width:80px;height:80px;border-radius:50%;background:var(--accent);margin:0 auto 1rem;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:bold;color:#000}
.player-name{font-size:1.5rem;font-weight:700;margin-bottom:.5rem;color:var(--text)}
.player-rating{font-size:2rem;font-weight:700;margin-bottom:.5rem;color:var(--secondary)}
.player-title{background:var(--accent);color:#000;padding:.25rem .75rem;border-radius:20px;font-size:.9rem;font-weight:600;display:inline-block}
.vs-divider{display:flex;align-items:center;justify-content:center;font-size:3rem;font-weight:700;color:var(--secondary);text-shadow:2px 2px 4px #000}
.comparison-metrics{display:grid;grid-template-columns:1fr 1fr;gap:1rem;margin-top:1.5rem}
.metric-item{background:#2a2a2a;padding:1rem;border-radius:8px;text-align:center;border:1px solid var(--border)}
.metric-value{font-size:1.3rem;font-weight:700;margin-bottom:.5rem;color:var(--secondary)}
.metric-label{font-size:.85rem;color:var(--sub)}


.power-bars-container{background:#1e1e1e;border:1px solid var(--border);border-radius:12px;padding:2rem;margin:2rem 0}
.power-bars-container h3{color:var(--secondary);margin-bottom:1.5rem;text-align:center}
.power-bar-item{margin-bottom:2rem}
.power-bar-label{font-weight:600;margin-bottom:.5rem;color:var(--text)}
.power-bar-wrapper{display:flex;align-items:center;gap:1rem}
.power-bar-player1{flex:1;height:30px;background:#222;border-radius:15px;overflow:hidden;position:relative}
.power-bar-player2{flex:1;height:30px;background:#222;border-radius:15px;overflow:hidden;position:relative}
.power-bar-fill{height:100%;border-radius:15px;transition:width 1s ease-in-out;position:relative;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:.9rem}
.power-bar-fill.player1{background:linear-gradient(90deg,var(--accent),#ff4757);color:#000}
.power-bar-fill.player2{background:linear-gradient(90deg,var(--secondary),#3742fa);color:#000}
.power-bar-center{min-width:60px;text-align:center;font-weight:600;color:var(--secondary)}


.radar-container{background:#1e1e1e;border:1px solid var(--border);border-radius:12px;padding:2rem;margin:2rem 0}
.radar-container h3{color:var(--secondary);margin-bottom:1rem;text-align:center}


.battle-arena{background:linear-gradient(135deg,#2d3748,#4a5568);border:1px solid var(--border);border-radius:12px;padding:2rem;margin:2rem 0;text-align:center;position:relative;overflow:hidden}
.battle-arena::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,.05) 0%,transparent 70%);animation:battleGlow 4s infinite alternate}
@keyframes battleGlow{0%{transform:scale(1) rotate(0deg)}100%{transform:scale(1.1) rotate(180deg)}}
.battle-title{font-size:2rem;font-weight:700;margin-bottom:1rem;position:relative;z-index:1;color:var(--text)}
.battle-outcome{font-size:1.2rem;font-weight:600;padding:1.5rem;background:rgba(255,255,255,.1);border-radius:8px;margin-top:1rem;position:relative;z-index:1;color:var(--text)}


.statistical-analysis{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-top:2rem}
.stat-card{background:linear-gradient(135deg,var(--accent),#ff4757);color:#fff;padding:1.5rem;border-radius:12px;text-align:center;box-shadow:0 10px 20px rgba(0,0,0,.3)}
.stat-value{font-size:1.8rem;font-weight:700;margin-bottom:.5rem}
.stat-label{font-size:.9rem;opacity:.9}


.compare-selectors{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem}
.compare-selectors select{padding:1rem;border:1px solid var(--border);border-radius:8px;font-size:1rem;font-weight:500;background:#222;color:var(--text);cursor:pointer;transition:all .3s ease}
.compare-selectors select:hover{border-color:var(--secondary)}
.compare-selectors select:focus{outline:none;border-color:var(--secondary)}


.game-management{background:#1e1e1e;border:1px solid var(--border);border-radius:12px;padding:2rem;margin:2rem 0}
.game-form{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem}
.game-list{max-height:400px;overflow-y:auto;border:1px solid var(--border);border-radius:8px}
.game-item{background:#2a2a2a;padding:1rem;border-bottom:1px solid var(--border);display:grid;grid-template-columns:1fr auto auto auto auto;gap:1rem;align-items:center}
.game-item:last-child{border-bottom:none}
.game-item:hover{background:#333}
.game-result{font-weight:600;padding:.25rem .5rem;border-radius:4px;font-size:.85rem}
.result-win{background:var(--success);color:#000}
.result-loss{background:var(--accent);color:#000}
.result-draw{background:var(--warning);color:#000}


@media (max-width: 768px) {
.comparison-container{grid-template-columns:1fr;gap:1.5rem}
.compare-selectors{grid-template-columns:1fr}
.power-bar-wrapper{flex-direction:column}
.power-bar-player1,.power-bar-player2{width:100%}
.ivcf-nav{flex-direction:column;align-items:center}
.ivcf-header{flex-direction:column;text-align:center}
}
</style>
</head>
<body>
<div class="ivcf-page active">
  <div class="ivcf-header">
    <h1>♟ IVCF 2.0 Hub</h1>
    <nav class="ivcf-nav">
      <a class="active" href="#" data-ipage="home">Home</a>
      <a href="#" data-ipage="ranking">Rankings</a>
      <a href="#" data-ipage="compare">Compare</a>
      <a href="#" data-ipage="events">Events</a>
      <a href="#" data-ipage="rules">Rules</a>
      <a href="#" data-ipage="calc">Rating Calc</a>
      <a href="#" data-ipage="results">Results</a>
      <a href="#" data-ipage="games">Game Manager</a>
      <a href="index.html">← Back to Hub</a>
    </nav>
  </div>

  <div class="ivcf-main">
  
    <section id="ivcf-home" class="ivcf-section active">
      <div class="ivcf-card">
        <h2>Welcome to IVCF 2.0 Hub</h2>
        <p>Official portal of the International Valorian Chess Federation (IVCF 2.0). Experience our enhanced comparison system with interactive visualizations and advanced analytics.</p>
        <p>
          <a class="ivcf-button" href="https://docs.google.com/forms/d/e/1FAIpQLSewCmbN4NJd_HeksuZkVm66dDKt7P0s6thkgYmj4S0FK3TGGA/viewform?usp=header  " target="_blank" style="display:inline-block; padding: 12px 24px; background: var(--accent); color: #000; text-decoration: none; border-radius: 4px; font-weight: bold;">
            Get a License
          </a>
        </p>
      </div>
    </section>

   
    <section id="ivcf-ranking" class="ivcf-section">
      <div class="ivcf-card">
        <h2>Live Rankings</h2>
        <input id="rankSearch" class="ivcf-input" placeholder="Search player / team / nation">
      </div>
      <table class="ivcf-table" id="rankTable">
        <thead>
          <tr><th>#</th><th>Player</th><th>Team</th><th>Nation</th><th>CCR</th><th>Title</th><th>Win Rate</th><th>Games</th><th>Streak</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>

    <section id="ivcf-compare" class="ivcf-section">
      <div class="ivcf-card">
        <h2>Advanced Player Comparison</h2>
        <div class="compare-selectors">
          <select id="leftPick">
            <option value="">— Select First Player —</option>
          </select>
          <select id="rightPick">
            <option value="">— Select Second Player —</option>
          </select>
        </div>
        
        <div id="comparisonContent" style="display: none;">
          <div class="comparison-container">
            <div class="player-card" id="leftPlayerCard">
              <div class="player-avatar" id="leftAvatar">P1</div>
              <div class="player-name" id="leftName">Player 1</div>
              <div class="player-rating" id="leftRating">2400</div>
              <div class="player-title" id="leftTitle">CEC</div>
              <div class="comparison-metrics" id="leftMetrics"></div>
            </div>
            
            <div class="vs-divider">VS</div>
            
            <div class="player-card" id="rightPlayerCard">
              <div class="player-avatar" id="rightAvatar">P2</div>
              <div class="player-name" id="rightName">Player 2</div>
              <div class="player-rating" id="rightRating">2300</div>
              <div class="player-title" id="rightTitle">CE</div>
              <div class="comparison-metrics" id="rightMetrics"></div>
            </div>
          </div>

          <div class="power-bars-container">
            <h3>Power Comparison - Head to Head</h3>
            <div id="powerBars"></div>
          </div>

          <div class="radar-container">
            <h3>Performance Radar - Real Statistics</h3>
            <div id="radarChart" style="width: 100%; height: 400px;"></div>
          </div>

          <div class="battle-arena" id="battleArena">
            <div class="battle-title">Battle Prediction</div>
            <div class="battle-outcome" id="battleOutcome">Select players to see prediction</div>
          </div>

          <div class="statistical-analysis" id="statisticalAnalysis"></div>
        </div>
      </div>
    </section>


<section id="ivcf-games" class="ivcf-section" style="display:none">
  <div class="ivcf-card">
    <h2>Game Management (Code-Only)</h2>
    <p>
      This section is hidden from normal users.  
      Games can <strong>only</strong> be added or edited directly in the source code.
    </p>

  
    <h3>Recorded Games</h3>
    <div class="game-list" id="gameList">
      <div style="padding: 2rem; text-align: center; color: var(--sub);">
        No games recorded yet. Add them in the source code!
      </div>
    </div>

    
    <div class="ivcf-card" style="margin-top:1.5rem">
      <h3>For Administrators</h3>
      <p>To add a result, open this file in any editor and append an object to the
      <code class="mono">defaultGameHistory</code> array (already declared near the top of the script):</p>
      <pre style="background:#222;padding:1rem;border-radius:4px;overflow:auto">
defaultGameHistory.push({
  id: Date.now(),                       // unique numeric id
  player1: "Beeba",                     // id of white/first player
  player2: "Dwayne",                    // id of black/second player
  result: "1-0",                        // 1-0, 0-1 or 0.5-0.5
  tournament: "CCWT 2025",              // any string
  date: "2025-11-06"                    // yyyy-mm-dd
});
      </pre>
      <p>Save the file, reload the page, and the new game will appear in rankings & comparisons automatically.</p>
    </div>
  </div>
</section>


<script>
document.addEventListener('DOMContentLoaded', () => {
  const navLinks = document.querySelectorAll('.ivcf-nav a[data-ipage="games"]');
  navLinks.forEach(link => link.remove());
});
</script>
   
    <section id="ivcf-events" class="ivcf-section">
      <div class="ivcf-card">
        <h2>Upcoming Events</h2>
        <h3>CCWT – Centralian Chess World Tournament</h3>
        <p>Main event - Starting Date unclear - $200 k 1st place.</p>
      </div>
      <div class="ivcf-card">
        <h3>VCC – Valorian Chess 960 Cup</h3>
        <p>Randomized starting positions. Prestige bonus only.</p>
      </div>
    </section>

   
    <section id="ivcf-rules" class="ivcf-section">
      <div class="ivcf-card">
        <h2>Quick-Reference Rules</h2>
        <h3>Licensing</h3>
        <ul>
          <li>One-time $20 k payment on licensing.</li>
          <li>Grants access to all official events & CCR tracking.</li>
        </ul>
      </div>
      <div class="ivcf-card">
        <h3>CCR Formula (IVCF 2.1 – faster climb)</h3>
        <p class="mono" style="background: #222; padding: 1rem; border-radius: 4px; border-left: 4px solid var(--secondary);">New = Old + K×(Result − E) + Bonus</p>
        <p>K = 50 (&lt;1400), 40 (1400-1799), 32 (1800-2199), 24 (2200-2399), 10 (2400+)</p>
        <p>E = 1 / (1 + 10^((Opp − Old) / 400))</p>
        <p>Bonuses: <br>
           +15 for beating +200 rating opponent<br>
           +10 for beating +100 rating opponent<br>
           +5 for beating +50 rating opponent<br>
           No inactivity penalty.</p>
      </div>
      <div class="ivcf-card">
        <h3>Title & Prestige (per tournament entry)</h3>
        <table class="ivcf-table">
          <thead><tr><th>Title</th><th>Range</th><th>Bonus</th></tr></thead>
          <tbody>
            <tr><td>IC (Intermediate Candidate)</td><td>400-999</td><td>$1 k</td></tr>
            <tr><td>AC (Advanced Candidate)</td><td>1000-1399</td><td>$2 k</td></tr>
            <tr><td>SCM (Senior Centralian Master)</td><td>1400-1699</td><td>$4 k</td></tr>
            <tr><td>CCM (Centralian Candidate Master)</td><td>1700-1999</td><td>$6 k</td></tr>
            <tr><td>CIM (Centralian International Master)</td><td>2000-2299</td><td>$8 k</td></tr>
            <tr><td>CE (Centralian Elite)</td><td>2300-2499</td><td>$12 k</td></tr>
            <tr><td>CEC (Centralian Elite Champion)</td><td>2500+</td><td>$20 k</td></tr>
          </tbody>
        </table>
      </div>
    </section>

   
    <section id="ivcf-calc" class="ivcf-section">
      <div class="ivcf-card">
        <h2>Rating Calculator</h2>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
          <div>
            <h3>Current Rating Calculation</h3>
            <div style="margin-bottom: 1rem;">
              <label>Your current CCR</label>
              <input class="ivcf-input" id="cOld" type="number" value="1800">
            </div>
            <div style="margin-bottom: 1rem;">
              <label>Opponent CCR</label>
              <input class="ivcf-input" id="cOpp" type="number" value="2000">
            </div>
            <div style="margin-bottom: 1rem;">
              <label>Result</label>
              <select class="ivcf-select" id="cRes">
                <option value="1">Win</option>
                <option value="0.5">Draw</option>
                <option value="0">Loss</option>
              </select>
            </div>
            <button class="ivcf-button" onclick="calcRating()">Calculate new CCR</button>
            <p id="cOut" style="margin-top: 1rem; font-weight: 600; color: var(--secondary);"></p>
          </div>
          <div>
            <h3>First-Ever CCR (vs 1000-bot)</h3>
            <div style="margin-bottom: 1rem;">
              <label>Chess.com estimated rating after game</label>
              <input class="ivcf-input" id="est" type="number" value="1000">
            </div>
            <div style="margin-bottom: 1rem;">
              <label>Result vs bot</label>
              <select class="ivcf-select" id="botRes">
                <option value="1">Win</option>
                <option value="0.5">Draw</option>
                <option value="0">Loss</option>
              </select>
            </div>
            <button class="ivcf-button" onclick="firstCCR()">Calculate starting CCR</button>
            <p id="firstOut" style="margin-top: 1rem; font-weight: 600; color: var(--secondary);"></p>
          </div>
        </div>
      </div>
    </section>

    
    <section id="ivcf-results" class="ivcf-section">
      <div class="ivcf-card">
        <h2>Event Results</h2>
        <p>No Results here yet, but hopefully in the future :)</p>
        <h3>Test (Place Holder)</h3>
        <table class="ivcf-table">
          <thead><tr><th>Place</th><th>Player</th><th>Prize</th></tr></thead>
          <tbody>
            <tr><td>1st</td><td>Test Player</td><td>$200 k</td></tr>
            <tr><td>2nd</td><td>---</td><td>$100 k</td></tr>
            <tr><td>3rd-4th</td><td>---</td><td>$50 k</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>

<script>
//Players List
const players = [
  {
    id: "Beeba",
    name: "Beeba",
    team: "None",
    nation: "Valoria",
    ccr: 1143,
    tournamentsWon: [],
    bonusEarned: 0
  },
  {
    id: "Dwayne",
    name: "Dwayne",
    team: "None",
    nation: "Solar",
    ccr: 1503,
    tournamentsWon: [],
    bonusEarned: 0
  }
];

const titleFromCCR = c => c < 1000 ? 'IC' : c < 1400 ? 'AC' : c < 1700 ? 'SCM' : c < 2000 ? 'CCM' : c < 2300 ? 'CIM' : c < 2500 ? 'CE' : 'CEC';


   //Edit this array directly in the source. Each entry must include:
  //id (unique), player1 (first player id), player2, result ("1-0", "0-1" or "0.5-0.5"), tournament, date ("yyyy-mm-dd").
const defaultGameHistory = [
  // sample entries — edit/delete/add as you like
  { id: 1001, player1: "Beeba", player2: "Dwayne", result: "0-1", tournament: "Friendly", date: "2025-10-20" },
  { id: 1002, player1: "Dwayne", player2: "Beeba", result: "0.5-0.5", tournament: "CCWT Qual", date: "2025-10-25" },
  { id: 1003, player1: "Beeba", player2: "Dwayne", result: "0-1", tournament: "Friendly", date: "2025-11-01" }
];


let gameHistory = defaultGameHistory.length ? defaultGameHistory.slice() : (JSON.parse(localStorage.getItem('ivcfGames')) || []);


function resetPlayerStats() {
  players.forEach(player => {
    player.gamesPlayed = 0;
    player.gamesWon = 0;
    player.winRate = 0;
    player.streak = 0;
    player.headToHeadWins = 0;
    player.headToHeadLosses = 0;
    player.performanceTrend = 50;
    player.games = []; 
  });
}

//Ranking
function buildRanking() {
  // compute derived title from CCR and sort by CCR desc
  const list = players.map(p => {
    const copy = {...p};
    copy.title = titleFromCCR(copy.ccr);
    return copy;
  }).sort((a, b) => b.ccr - a.ccr);

  const tbody = document.querySelector('#rankTable tbody');
  tbody.innerHTML = '';
  list.forEach((p, i) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${i + 1}</td>
      <td>${p.name}</td>
      <td>${p.team}</td>
      <td>${p.nation}</td>
      <td>${p.ccr}</td>
      <td>${p.title}</td>
      <td>${p.winRate}%</td>
      <td>${p.gamesPlayed}</td>
      <td>${p.streak}</td>
    `;
    tbody.appendChild(tr);
  });
}


document.getElementById('rankSearch').addEventListener('input', e => {
  const q = e.target.value.toLowerCase();
  document.querySelectorAll('#rankTable tbody tr').forEach(row => {
    row.style.display = row.innerText.toLowerCase().includes(q) ? '' : 'none';
  });
});


document.querySelectorAll('.ivcf-nav a[data-ipage]').forEach(a => {
  a.addEventListener('click', ev => {
    ev.preventDefault();
    document.querySelectorAll('.ivcf-section').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.ivcf-nav a').forEach(x => x.classList.remove('active'));
    const page = a.dataset.ipage;
    document.getElementById('ivcf-' + page).classList.add('active');
    a.classList.add('active');
  });
});


const leftSel = document.getElementById('leftPick');
const rightSel = document.getElementById('rightPick');
const comparisonContent = document.getElementById('comparisonContent');

function fillSelects() {
  // clear any existing options besides placeholder
  [leftSel, rightSel].forEach(sel => {
    // remove existing options except first
    while (sel.options.length > 1) sel.remove(1);
  });

  players.forEach(p => {
    leftSel.insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name} (${p.ccr})</option>`);
    rightSel.insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name} (${p.ccr})</option>`);
  });
}
fillSelects();

function createPowerBars(leftPlayer, rightPlayer) {
  const powerBars = document.getElementById('powerBars');
  
  const metrics = [
    { label: 'Rating Power', left: Math.min((leftPlayer.ccr / 3000) * 100, 100), right: Math.min((rightPlayer.ccr / 3000) * 100, 100) },
    { label: 'Win Rate Dominance', left: leftPlayer.winRate, right: rightPlayer.winRate },
    { label: 'Experience Factor', left: Math.min((leftPlayer.gamesPlayed / 200) * 100, 100), right: Math.min((rightPlayer.gamesPlayed / 200) * 100, 100) },
    { label: 'Current Streak Power', left: Math.min((leftPlayer.streak / 20) * 100, 100), right: Math.min((rightPlayer.streak / 20) * 100, 100) },
    { label: 'Tournament Success', left: Math.min((leftPlayer.tournamentsWon ? leftPlayer.tournamentsWon.length : 0) / 5 * 100, 100), right: Math.min((rightPlayer.tournamentsWon ? rightPlayer.tournamentsWon.length : 0) / 5 * 100, 100) }
  ];

  powerBars.innerHTML = metrics.map(metric => {
    const total = metric.left + metric.right;
    const leftPercent = total > 0 ? (metric.left / total) * 100 : 50;
    const rightPercent = total > 0 ? (metric.right / total) * 100 : 50;
    
    return `
      <div class="power-bar-item">
        <div class="power-bar-label">${metric.label}</div>
        <div class="power-bar-wrapper">
          <div class="power-bar-player1">
            <div class="power-bar-fill player1" style="width: ${leftPercent}%; margin-left: ${100 - leftPercent}%;">${Math.round(metric.left)}%</div>
          </div>
          <div class="power-bar-center">VS</div>
          <div class="power-bar-player2">
            <div class="power-bar-fill player2" style="width: ${rightPercent}%;">${Math.round(metric.right)}%</div>
          </div>
        </div>
      </div>
    `;
  }).join('');
}

function createRadarChart(leftPlayer, rightPlayer) {
  const leftStats = calculatePlayerStatsFromGames(leftPlayer.id);
  const rightStats = calculatePlayerStatsFromGames(rightPlayer.id);
  
  const categories = ['Win Rate', 'Consistency', 'Pressure Handling', 'Comeback Ability', 'Endgame Performance'];
  const leftValues = [
    leftPlayer.winRate,
    leftPlayer.performanceTrend,
    leftStats.pressureHandling,
    leftStats.comebackAbility,
    leftStats.endgamePerformance
  ];
  const rightValues = [
    rightPlayer.winRate,
    rightPlayer.performanceTrend,
    rightStats.pressureHandling,
    rightStats.comebackAbility,
    rightStats.endgamePerformance
  ];

  const data = [{
    type: 'scatterpolar',
    r: leftValues,
    theta: categories,
    fill: 'toself',
    name: leftPlayer.name,
    line: { color: '#dc143c' },
    fillcolor: 'rgba(220, 20, 60, 0.3)'
  }, {
    type: 'scatterpolar',
    r: rightValues,
    theta: categories,
    fill: 'toself',
    name: rightPlayer.name,
    line: { color: '#00b4ff' },
    fillcolor: 'rgba(0, 180, 255, 0.3)'
  }];

  const layout = {
    polar: {
      radialaxis: { visible: true, range: [0, 100], tickfont: { size: 12, color: '#aaa' } },
      angularaxis: { tickfont: { color: '#fff' } }
    },
    showlegend: true,
    legend: { x: 0.5, y: -0.1, xanchor: 'center', orientation: 'h', font: { color: '#fff' } },
    font: { family: 'system-ui, sans-serif', color: '#fff' },
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)'
  };

  Plotly.newPlot('radarChart', data, layout, {responsive: true});
}

function calculatePlayerStatsFromGames(playerId) {
  const playerGames = gameHistory.filter(game => 
    game.player1 === playerId || game.player2 === playerId
  );
  
  if (playerGames.length === 0) {
    return { pressureHandling: 75, comebackAbility: 60, endgamePerformance: 70 };
  }
  
  let wins = 0, losses = 0, draws = 0, comebackWins = 0, pressureGames = 0, pressureWins = 0;
  const player = players.find(p => p.id === playerId);

  playerGames.forEach(game => {
    const parts = game.result.split('-').map(s => s.trim());
    const [p1Result, p2Result] = parts;
    const isPlayer1 = game.player1 === playerId;
    const opponentId = isPlayer1 ? game.player2 : game.player1;
    const opponent = players.find(p => p.id === opponentId);

    // count result
    if (isPlayer1) {
      if (p1Result === '1') { wins++; if (opponent && opponent.ccr > (player.ccr + 100)) { pressureWins++; comebackWins++; } }
      else if (p2Result === '1') { losses++; }
      else { draws++; }
    } else {
      if (p2Result === '1') { wins++; if (opponent && opponent.ccr > (player.ccr + 100)) { pressureWins++; comebackWins++; } }
      else if (p1Result === '1') { losses++; }
      else { draws++; }
    }

    if (opponent && opponent.ccr > (player.ccr + 50)) pressureGames++;
  });

  const pressureHandling = pressureGames > 0 ? Math.round((pressureWins / pressureGames) * 100) : 75;
  const comebackAbility = wins > 0 ? Math.round((comebackWins / wins) * 100) : 60;
  const endgamePerformance = wins + losses + draws > 0 ? Math.round((wins / (wins + losses + draws)) * 100) : 70;

  return {
    pressureHandling: Math.max(pressureHandling, 50),
    comebackAbility: Math.max(comebackAbility, 50),
    endgamePerformance: Math.max(endgamePerformance, 50)
  };
}

function createStatisticalAnalysis(leftPlayer, rightPlayer) {
  const analysis = document.getElementById('statisticalAnalysis');
  
  const ratingDiff = Math.abs(leftPlayer.ccr - rightPlayer.ccr);
  const winProbLeft = 1 / (1 + Math.pow(10, (rightPlayer.ccr - leftPlayer.ccr) / 400));
  const winProbRight = 1 - winProbLeft;
  const performanceGap = Math.abs(leftPlayer.performanceTrend - rightPlayer.performanceTrend);
  
  const h2hGames = gameHistory.filter(game => 
    (game.player1 === leftPlayer.id && game.player2 === rightPlayer.id) ||
    (game.player1 === rightPlayer.id && game.player2 === leftPlayer.id)
  );
  
  let leftH2HWins = 0, rightH2HWins = 0, h2hDraws = 0;
  h2hGames.forEach(game => {
    const parts = game.result.split('-').map(s => s.trim());
    const [p1Result, p2Result] = parts;
    if (game.player1 === leftPlayer.id) {
      if (p1Result === '1') leftH2HWins++;
      else if (p2Result === '1') rightH2HWins++;
      else h2hDraws++;
    } else {
      if (p2Result === '1') leftH2HWins++;
      else if (p1Result === '1') rightH2HWins++;
      else h2hDraws++;
    }
  });

  const stats = [
    { label: 'Rating Difference', value: ratingDiff },
    { label: `${leftPlayer.name} Win Probability`, value: Math.round(winProbLeft * 100) + '%' },
    { label: `${rightPlayer.name} Win Probability`, value: Math.round(winProbRight * 100) + '%' },
    { label: 'Head-to-Head', value: `${leftH2HWins}-${rightH2HWins}-${h2hDraws}` },
    { label: 'Performance Gap', value: performanceGap + ' points' }
  ];

  analysis.innerHTML = stats.map(stat => `
    <div class="stat-card">
      <div class="stat-value">${stat.value}</div>
      <div class="stat-label">${stat.label}</div>
    </div>
  `).join('');
}

function predictBattleOutcome(leftPlayer, rightPlayer) {
  const battleOutcome = document.getElementById('battleOutcome');
  let leftScore = 0, rightScore = 0;

  if (leftPlayer.ccr > rightPlayer.ccr) leftScore += 3; else if (rightPlayer.ccr > leftPlayer.ccr) rightScore += 3;
  if (leftPlayer.winRate > rightPlayer.winRate) leftScore += 2; else if (rightPlayer.winRate > leftPlayer.winRate) rightScore += 2;
  if (leftPlayer.performanceTrend > rightPlayer.performanceTrend) leftScore += 1; else if (rightPlayer.performanceTrend > leftPlayer.performanceTrend) rightScore += 1;
  if (leftPlayer.gamesPlayed > rightPlayer.gamesPlayed) leftScore += 1; else if (rightPlayer.gamesPlayed > leftPlayer.gamesPlayed) rightScore += 1;

  const h2hGames = gameHistory.filter(game => 
    (game.player1 === leftPlayer.id && game.player2 === rightPlayer.id) ||
    (game.player1 === rightPlayer.id && game.player2 === leftPlayer.id)
  );
  let leftH2HWins = 0, rightH2HWins = 0;
  h2hGames.forEach(game => {
    const parts = game.result.split('-').map(s => s.trim());
    const [p1Result, p2Result] = parts;
    if (game.player1 === leftPlayer.id) {
      if (p1Result === '1') leftH2HWins++;
      else if (p2Result === '1') rightH2HWins++;
    } else {
      if (p2Result === '1') leftH2HWins++;
      else if (p1Result === '1') rightH2HWins++;
    }
  });

  if (leftH2HWins > rightH2HWins) leftScore += 2;
  else if (rightH2HWins > leftH2HWins) rightScore += 2;

  let outcome = '';
  if (leftScore > rightScore) outcome = `${leftPlayer.name} is favored to win (${leftScore}-${rightScore} advantage)`;
  else if (rightScore > leftScore) outcome = `${rightPlayer.name} is favored to win (${rightScore}-${leftScore} advantage)`;
  else outcome = 'Very close match - could go either way!';

  battleOutcome.textContent = outcome;
}

function renderCompare() {
  const leftPlayer = players.find(x => x.id === leftSel.value);
  const rightPlayer = players.find(x => x.id === rightSel.value);
  
  if (!leftPlayer || !rightPlayer) {
    comparisonContent.style.display = 'none';
    return;
  }

  comparisonContent.style.display = 'block';

  document.getElementById('leftName').textContent = leftPlayer.name;
  document.getElementById('leftRating').textContent = leftPlayer.ccr;
  document.getElementById('leftTitle').textContent = titleFromCCR(leftPlayer.ccr);
  document.getElementById('leftAvatar').textContent = leftPlayer.name.charAt(0);

  document.getElementById('rightName').textContent = rightPlayer.name;
  document.getElementById('rightRating').textContent = rightPlayer.ccr;
  document.getElementById('rightTitle').textContent = titleFromCCR(rightPlayer.ccr);
  document.getElementById('rightAvatar').textContent = rightPlayer.name.charAt(0);

  const leftMetrics = document.getElementById('leftMetrics');
  const rightMetrics = document.getElementById('rightMetrics');

  leftMetrics.innerHTML = `
    <div class="metric-item">
      <div class="metric-value">${leftPlayer.gamesWon}</div>
      <div class="metric-label">Games Won</div>
    </div>
    <div class="metric-item">
      <div class="metric-value">${leftPlayer.winRate}%</div>
      <div class="metric-label">Win Rate</div>
    </div>
    <div class="metric-item">
      <div class="metric-value">${leftPlayer.streak}</div>
      <div class="metric-label">Current Streak</div>
    </div>
    <div class="metric-item">
      <div class="metric-value">$${leftPlayer.bonusEarned}k</div>
      <div class="metric-label">Earnings</div>
    </div>
  `;

  rightMetrics.innerHTML = `
    <div class="metric-item">
      <div class="metric-value">${rightPlayer.gamesWon}</div>
      <div class="metric-label">Games Won</div>
    </div>
    <div class="metric-item">
      <div class="metric-value">${rightPlayer.winRate}%</div>
      <div class="metric-label">Win Rate</div>
    </div>
    <div class="metric-item">
      <div class="metric-value">${rightPlayer.streak}</div>
      <div class="metric-label">Current Streak</div>
    </div>
    <div class="metric-item">
      <div class="metric-value">$${rightPlayer.bonusEarned}k</div>
      <div class="metric-label">Earnings</div>
    </div>
  `;

  createPowerBars(leftPlayer, rightPlayer);
  createRadarChart(leftPlayer, rightPlayer);
  createStatisticalAnalysis(leftPlayer, rightPlayer);
  predictBattleOutcome(leftPlayer, rightPlayer);
}

[leftSel, rightSel].forEach(sel => sel.addEventListener('change', renderCompare));




function fillGameSelectors() {
  const gamePlayer1 = document.getElementById('gamePlayer1');
  const gamePlayer2 = document.getElementById('gamePlayer2');
  if (!gamePlayer1 || !gamePlayer2) return;
 
  while (gamePlayer1.options.length > 0) gamePlayer1.remove(0);
  while (gamePlayer2.options.length > 0) gamePlayer2.remove(0);
  players.forEach(p => {
    gamePlayer1.insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name} (${p.ccr})</option>`);
    gamePlayer2.insertAdjacentHTML('beforeend', `<option value="${p.id}">${p.name} (${p.ccr})</option>`);
  });
}
fillGameSelectors();


function addGame() {
  const player1IdEl = document.getElementById('gamePlayer1');
  const player2IdEl = document.getElementById('gamePlayer2');
  const resultEl = document.getElementById('gameResult');
  const tournamentEl = document.getElementById('gameTournament');
  const dateEl = document.getElementById('gameDate');
  if (!player1IdEl || !player2IdEl || !resultEl) { alert('Game UI not available. Edit defaultGameHistory in source.'); return; }

  const player1Id = player1IdEl.value;
  const player2Id = player2IdEl.value;
  const result = resultEl.value;
  const tournament = tournamentEl ? tournamentEl.value || 'Friendly Match' : 'Friendly Match';
  const date = dateEl ? (dateEl.value || new Date().toISOString().split('T')[0]) : new Date().toISOString().split('T')[0];

  if (!player1Id || !player2Id || !result || player1Id === player2Id) {
    alert('Please select two different players and a valid result');
    return;
  }

  const game = { id: Date.now(), player1: player1Id, player2: player2Id, result: result, tournament: tournament, date: date };
  gameHistory.push(game);
  localStorage.setItem('ivcfGames', JSON.stringify(gameHistory));
  recalculateAllStatsAndRefresh();

  player1IdEl.value = '';
  player2IdEl.value = '';
  resultEl.value = '';
  if (tournamentEl) tournamentEl.value = '';
  if (dateEl) dateEl.value = '';
  alert('Game added successfully!');
}

function updatePlayerStats(game) {
  const p1 = players.find(p => p.id === game.player1);
  const p2 = players.find(p => p.id === game.player2);
  if (!p1 || !p2) return;

  p1.gamesPlayed++;
  p2.gamesPlayed++;

  const parts = game.result.split('-').map(s => s.trim());
  const [p1Result, p2Result] = parts;

  if (p1Result === '1') {
    p1.gamesWon++;
    p1.streak = (p1.streak || 0) + 1;
    p2.streak = 0;
    p1.headToHeadWins = (p1.headToHeadWins || 0) + 1;
    p2.headToHeadLosses = (p2.headToHeadLosses || 0) + 1;
  } else if (p2Result === '1') {
    p2.gamesWon++;
    p2.streak = (p2.streak || 0) + 1;
    p1.streak = 0;
    p2.headToHeadWins = (p2.headToHeadWins || 0) + 1;
    p1.headToHeadLosses = (p1.headToHeadLosses || 0) + 1;
  } else {
 
    p1.streak = 0;
    p2.streak = 0;
  }

  p1.winRate = Math.round((p1.gamesWon / p1.gamesPlayed) * 100);
  p2.winRate = Math.round((p2.gamesWon / p2.gamesPlayed) * 100);

  updatePerformanceTrend(p1);
  updatePerformanceTrend(p2);
}

function updatePerformanceTrend(player) {
  const playerGames = gameHistory.filter(game => game.player1 === player.id || game.player2 === player.id)
                                 .slice(-10); // last 10
  if (playerGames.length === 0) {
    player.performanceTrend = 50;
    return;
  }
  let recentWins = 0;
  playerGames.forEach(game => {
    const parts = game.result.split('-').map(s => s.trim());
    const [p1Result, p2Result] = parts;
    if ((game.player1 === player.id && p1Result === '1') || (game.player2 === player.id && p2Result === '1')) {
      recentWins++;
    }
  });
  player.performanceTrend = Math.round((recentWins / playerGames.length) * 100);
}

function renderGameList() {
  const gameList = document.getElementById('gameList');
  
  if (!gameHistory || gameHistory.length === 0) {
    gameList.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--sub);">No games recorded yet. Add your first game in the source code (defaultGameHistory)!</div>';
    return;
  }
  
  gameList.innerHTML = gameHistory.map(game => {
    const p1 = players.find(p => p.id === game.player1) || { name: game.player1, ccr: '—' };
    const p2 = players.find(p => p.id === game.player2) || { name: game.player2, ccr: '—' };
    const parts = game.result.split('-').map(s => s.trim());
    const [p1Result, p2Result] = parts;
    
    let resultClass = 'result-draw';
    let resultText = 'Draw';
    if (p1Result === '1') { resultClass = 'result-win'; resultText = `${p1.name} Wins`; }
    else if (p2Result === '1') { resultClass = 'result-loss'; resultText = `${p2.name} Wins`; }

    return `
      <div class="game-item">
        <div>
          <strong>${p1.name}</strong> (${p1.ccr}) vs <strong>${p2.name}</strong> (${p2.ccr})
        </div>
        <div class="game-result ${resultClass}">${resultText}</div>
        <div>${game.tournament}</div>
        <div>${game.date}</div>
        <div>
          <button onclick="deleteGame(${game.id})" style="background: var(--accent); color: #000; border: none; padding: 0.25rem 0.5rem; border-radius: 4px; cursor: pointer; font-size: 0.8rem;">Delete</button>
        </div>
      </div>
    `;
  }).join('');
}

function deleteGame(gameId) {
  if (!confirm('Are you sure you want to delete this game?')) return;
  gameHistory = gameHistory.filter(g => g.id !== gameId);
 
  localStorage.setItem('ivcfGames', JSON.stringify(gameHistory));
  recalculateAllStatsAndRefresh();
}


function recalculateAllStatsAndRefresh() {
  resetPlayerStats();
 
  const sortedGames = gameHistory.slice().sort((a,b) => {
   
    if (a.date && b.date) return a.date.localeCompare(b.date);
    return a.id - b.id;
  });
  sortedGames.forEach(game => updatePlayerStats(game));

  players.forEach(p => {
    p.gamesPlayed = p.gamesPlayed || 0;
    p.gamesWon = p.gamesWon || 0;
    p.winRate = p.winRate || 0;
    p.streak = p.streak || 0;
  });
  buildRanking();
  renderGameList();

  fillSelects();
  renderCompare();
}


function calcRating() {
  const old = +document.getElementById('cOld').value;
  const opp = +document.getElementById('cOpp').value;
  const res = +document.getElementById('cRes').value;
  let k = 50;
  if (old >= 2400) k = 10;
  else if (old >= 2200) k = 24;
  else if (old >= 1800) k = 32;
  else if (old >= 1400) k = 40;
  const e = 1 / (1 + 10 ** ((opp - old) / 400));
  let delta = k * (res - e);
  if (res === 1) {
    const diff = opp - old;
    if (diff >= 200) delta += 15;
    else if (diff >= 100) delta += 10;
    else if (diff >= 50) delta += 5;
  }
  const neu = Math.round(old + delta);
  let bonus = '';
  if (delta > k * 0.75) bonus = ' (big upset bonus)';
  else if (delta > 0) bonus = ' (bonus)';
  document.getElementById('cOut').textContent = `New CCR: ${neu}${bonus}`;
}

function firstCCR() {
  const est = +document.getElementById('est').value;
  const res = +document.getElementById('botRes').value;
  const bot = 1000;
  let k = 50;
  const e = 1 / (1 + 10 ** ((bot - est) / 400));
  let delta = k * (res - e);
  if (res === 1) {
    const diff = bot - est;
    if (diff >= 200) delta += 100;
    else if (diff >= 100) delta += 75;
    else if (diff >= 50) delta += 50;
    else delta += 25;
  }
  if (res === 0.5) delta += 25;
  const start = Math.round(est + delta);
  document.getElementById('firstOut').textContent =
    `Starting CCR: ${start} (use this as "old" in the rating calculator)`;
}


document.addEventListener('DOMContentLoaded', () => {
 
  try {
    const saved = JSON.parse(localStorage.getItem('ivcfGames')) || [];
    if (!defaultGameHistory.length && saved.length) {
      gameHistory = saved.slice();
    }
  } catch (e) {
  
  }
  
  recalculateAllStatsAndRefresh();
});
</script>
</body>
</html>
